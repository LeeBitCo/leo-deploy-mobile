webpackJsonp([112],{CJ9T:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o("s/F+"),c=o.n(i),n=o("yrbl"),r=o.n(n),a=o("44Rm"),s=o("+h5c"),u=o("s/fh"),l={data:function(){return{photos:[],qiniuDomain:"https://upload-z2.qiniup.com",imgUrl:"//qiniu.aiyoyoufang.com/",model:{name:"",icon:""},dataForm:{picUrl:null,roomScaleId:null,hotelId:this},show_pic:!1,show_fangPic:!1,current_pic:null,topPic:null,chooseAll:[{num:"0",title:"设置为首页"},{num:"1",title:"删除图片"}]}},created:function(){this.getqiniu(),this.$store.commit("setHeader",""+this.$route.query.type=="hotel"?"酒店图片":"房型图片")},methods:{getqiniu:function(){var t=this;Object(a.d)().done(function(e){t.token=e.data,"hotel"==t.$route.query.type?t.getHotelPic(t.$route.query.hotelId):t.getScalePic(t.$route.query.roomScaleId)})},getHotelPic:function(t){var e=this;Object(a.c)({hotelId:t}).done(function(t){e.photos=t.data,e.topPic=localStorage.getItem("topPic"),e.topPic&&(e.photos.find(function(t){return t.domainName+t.picUrl==e.topPic}).topPicNum=1)})},getScalePic:function(t){var e=this;Object(a.f)({roomScaleId:t}).done(function(t){e.photos=t.data,e.topPic=localStorage.getItem("topPic"),e.topPic&&(e.photos.find(function(t){return t.domainName+t.picUrl==e.topPic}).topPicNum=1)})},check:function(t){this.current_pic=t.domainName+t.picUrl,this.show_fangPic=!0},edit:function(t){this.currentInfo=t,this.show_pic=!0},setting:function(t){"0"==t?this.setFirstPic(this.currentInfo):this.removeImg(this.currentInfo),this.show_pic=!1},setFirstPic:function(t){var e=this;if("hotel"==this.$route.query.type)Object(a.s)({hotelPictureId:t.id}).done(function(o){localStorage.setItem("topPic",t.domainName+t.picUrl),e.getqiniu(),Object(u.c)(o.msg)});else{var o={picId:t.id,roomScaleId:this.$route.query.roomScaleId};Object(a.z)(o).done(function(o){localStorage.setItem("topPic",t.domainName+t.picUrl),e.getqiniu(),Object(u.c)(o.msg)})}},removeImg:function(t){var e=this;"hotel"==this.$route.query.type?Object(a.t)({hotelPictrueId:t.id}).done(function(t){Object(u.c)(t.msg),e.getHotelPic(e.$route.query.hotelId)}):Object(a.A)({roomPictrueId:t.id}).done(function(t){Object(u.c)(t.msg),e.getScalePic(e.$route.query.roomScaleId)})},upLoadToQiniu:function(t){var e=this;return r()(c.a.mark(function o(){var i,n,r,a,u,l;return c.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:i={headers:{"Content-Type":"multipart/form-data"},domain:""},"","image/png"==t.file.type?"png":"jpg",n=e.token,(r=new FormData).append("file",t.file),r.append("token",n),a=e,u={next:function(t){},error:function(t){},complete:function(t){a.dataForm.picUrl=t.key,a.upLoadPic()}},l=s.a(t.file,"key/upload/"+(new Date).getTime()+".png",n,i),l.subscribe(u);case 11:case"end":return o.stop()}},o,e)}))()},upLoadPic:function(){var t=this;"hotel"==this.$route.query.type?(this.dataForm.hotelId=this.$route.query.hotelId,delete this.dataForm.roomScaleId,Object(a.r)(this.dataForm).done(function(e){Object(u.c)(e.msg),t.getqiniu()})):(this.dataForm.roomScaleId=this.$route.query.roomScaleId,delete this.dataForm.hotelId,Object(a.y)(this.dataForm).done(function(e){Object(u.c)(e.msg),t.getqiniu()}))},beforeUpload:function(t){var e="image/jpeg"==t.type||"image/png"==t.type,o=t.size/1024/1024<10;return e||this.$message({showClose:!0,message:"上传图片只能是JPG/PNG 格式!",type:"error"}),o||this.$message({showClose:!0,message:"上传头像图片大小不能超过 10MB!",type:"error"}),e&&o}}},d={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("div",{attrs:{id:"pic-box"}},[t._l(t.photos,function(e){return o("div",{key:e.id,staticClass:"f-url-box",on:{click:function(o){return o.stopPropagation(),t.edit(e)}}},[o("img",{attrs:{src:e.domainName+e.picUrl,alt:""}}),t._v(" "),o("div",{staticClass:"f-url-edit"},[t._v(t._s(t.topPic&&e.topPicNum?"首页":""))])])}),t._v(" "),o("div",{staticClass:"f-url-box f-url-upload"},[o("van-uploader",{staticClass:"picBox",attrs:{"after-read":t.upLoadToQiniu,"upload-text":"点击上传"}})],1),t._v(" "),o("van-popup",{staticStyle:{width:"90%",height:"40%"},model:{value:t.show_fangPic,callback:function(e){t.show_fangPic=e},expression:"show_fangPic"}},[o("img",{staticClass:"pig-pic",attrs:{src:t.current_pic,alt:""}})]),t._v(" "),o("van-popup",{attrs:{position:"bottom"},model:{value:t.show_pic,callback:function(e){t.show_pic=e},expression:"show_pic"}},[o("div",{staticStyle:{color:"#000","font-size":"14px","line-height":"36px"}},[t._l(t.chooseAll,function(e,i){return o("div",{key:i},[o("div",{style:{color:"0"==e.num?"#000":"red"},on:{click:function(o){return t.setting(e.num)}}},[t._v(t._s(e.title))])])}),t._v(" "),o("div",{staticStyle:{height:"6px",background:"#CDCDD1",opacity:"0.2"}}),t._v(" "),o("div",{staticStyle:{color:"#7C7C7C"},on:{click:function(e){t.show_pic=!1}}},[t._v("取消")])],2)])],2)])},staticRenderFns:[]};var p=o("k6Sl")(l,d,!1,function(t){o("l5SI")},"data-v-40a3f7f1",null);e.default=p.exports},l5SI:function(t,e){}});
//# sourceMappingURL=112.832c9371dd1d41a20eca1758771190591.js.map