webpackJsonp([77],{Gtnr:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o("HkQL"),a=o.n(i),l=o("UJbh"),s=o("T6yf"),n=o("s/fh"),c=o("RmFe"),r=o.n(c),d={data:function(){return{allRooms:[],value:null,aaa:null,my_hotelLockType:null,my_lockInstall:null,my_doorType:null,lockInstallTypeObj:{},lockTypeObj:{},doorTypeObj:{},machineType:"请选择型号",airEleType:"请选择型号",gateWayType:"请选择型号",showFloor:!1,showLockType:!1,showDoorInstall:!1,showDoorType:!1,showRooms:!1,allRoomsStatus:!1,showMachineType:!1,showAirEle:!1,showGateWay:!1,isLight:!1,isCode:!1,showTime:!1,nothingID:!1,time:null,times:[],lockTypes:[],doorInstalls:[],doorTypes:[],autoMachine:[],hotelElecDev:[],hotelGateWay:[],machineStepper:0,airEleStepper:0,gateWayStepper:0,stepper:1,addAllRooms:[],materielTypes:[],codeSuit:[],machinePrice:0,airElePrice:0,gateWayPrice:0,isEdit:"0"}},created:function(){this.$store.commit("setHeader","添加设备"),this.getType(),this.getLockInfo()},methods:{getLockInfo:function(){var e=this;Object(s.f)({auditApprovalId:this.$route.query.auditApprovalId}).done(function(t){if(t.data){e.$store.commit("setHeader","编辑设备"),e.isEdit="1",t.data.lockInfo&&(e.showFloor=!0),e.id=t.data.id,e.allRooms=t.data.lockInfo?JSON.parse(t.data.lockInfo):[],e.devInfo=t.data.devInfo?JSON.parse(t.data.devInfo):[],e.materielTypes=t.data.materialInfo?JSON.parse(t.data.materialInfo):[];var o=e.devInfo.find(function(e){return"machine_type"==e.type});e.machineType=o?o.devName:"无",e.machinePrice=o?o.price:"0",e.machineValue=o?o.devValue:null,e.machineStepper=o?o.num:"0";var i=e.devInfo.find(function(e){return"airEle_type"==e.type});e.airEleType=i?i.devName:"无",e.airElePrice=i?i.price:"0",e.airEleValue=i?i.devValue:null,e.airEleStepper=i?i.num:"0";var a=e.devInfo.find(function(e){return"gateWay_type"==e.type});e.gateWayType=a?a.devName:"无",e.gateWayPrice=a?a.price:"0",e.gateWayValue=a?a.devValue:null,e.gateWayStepper=a?a.num:"0",e.stepper=e.materielTypes.find(function(e){return"XLQR"==e.devValue}).num,Object(l.a)({dictType:"business_hotel_qr_suit"}).done(function(t){e.codeSuit=t.data})}})},getRooms:function(){var e=this;Object(s.h)({hotelId:this.$route.query.applyHotelId}).done(function(t){e.addAllRooms=t.data.map(function(t){return t.lockType_title="锁类型",t.installType_title="装锁方式",t.doorType_title="开门类型",t.hotelLockType?t.price=e.lockTypesAll.find(function(e){return e.dictValue==t.hotelLockType}).extraValue:t.price="0",t.status=!1,t})})},getType:function(){var e=this;Object(l.a)({dictType:"business_lock_install_type"}).done(function(t){e.lockTypesAll=t.data;var o={};t.data.map(function(e){o[e.dictValue]=e.dictLabel}),e.lockInstallTypeObj=o,e.lockTypes=t.data.map(function(e){return e.dictLabel})}),Object(l.a)({dictType:"business_room_door_install"}).done(function(t){e.doorInstallsAll=t.data;var o={};t.data.map(function(e){o[e.dictValue]=e.dictLabel}),e.lockTypeObj=o,e.doorInstalls=t.data.map(function(e){return e.dictLabel})}),Object(l.a)({dictType:"business_room_door_type"}).done(function(t){e.doorTypesAll=t.data;var o={};t.data.map(function(e){o[e.dictValue]=e.dictLabel}),e.doorTypeObj=o,e.doorTypes=t.data.map(function(e){return e.dictLabel})}),Object(l.a)({dictType:"business_auto_machine"}).done(function(t){t.data.push({dictLabel:"无",dictValue:"noMachine",extraValue:"0",type:"autoMachine"}),e.autoMachineAll=t.data,e.autoMachine=t.data.map(function(e){return e.dictLabel}),e.machineType=e.autoMachineAll[0].dictLabel,e.machinePrice=e.autoMachineAll[0].extraValue,e.machineValue=e.autoMachineAll[0].dictValue}),Object(l.a)({dictType:"business_hotel_elec_dev"}).done(function(t){t.data.push({dictLabel:"无",dictValue:"noElec",extraValue:"0",type:"elecDev"}),e.hotelElecDevAll=t.data,e.hotelElecDev=t.data.map(function(e){return e.dictLabel}),e.airEleType=e.hotelElecDevAll[0].dictLabel,e.airElePrice=e.hotelElecDevAll[0].extraValue||"0",e.airEleValue=e.hotelElecDevAll[0].dictValue}),Object(l.a)({dictType:"business_gate_way"}).done(function(t){t.data.push({dictLabel:"无",dictValue:"noElec",extraValue:"0",type:"gateWay"}),e.hotelGateWayAll=t.data,e.hotelGateWay=t.data.map(function(e){return e.dictLabel}),e.gateWayType=e.hotelGateWayAll[0].dictLabel,e.gateWayPrice=e.hotelGateWayAll[0].extraValue||"0",e.gateWayValue=e.hotelGateWayAll[0].dictValue}),Object(l.a)({dictType:"business_hotel_material"}).done(function(t){e.materielTypes=t.data}),Object(l.a)({dictType:"business_hotel_qr_suit"}).done(function(t){e.codeSuit=t.data,e.getRooms()}),this.time=r()().year();for(var t=r()().year(),o=0;o<=5;o++)this.times.push(t--)},showAll:function(e,t){this.index=e,"lock"==t?this.showLockType=!0:"order"==t?this.showDoorInstall=!0:"open"==t&&(this.showDoorType=!0)},onConfirmLockType:function(e){var t=this,o=this.lockTypesAll.find(function(t){if(t.dictLabel==e)return t});this.allRooms.map(function(i,a){t.index==a&&(i.lockType_title=e,i.price=o.extraValue,i.hotelLockType=o.dictValue,i.lockType=o.dictValue)}),this.showLockType=!1},onConfirmDoorInstalls:function(e){var t=this,o=this.doorInstallsAll.find(function(t){if(t.dictLabel==e)return t});this.allRooms.map(function(i,a){t.index==a&&(i.installType_title=e,i.lockInstall=o.dictValue,i.installType=o.dictValue)}),this.showDoorInstall=!1},onConfirmDoorTypes:function(e){var t=this,o=this.doorTypesAll.find(function(t){if(t.dictLabel==e)return t});this.allRooms.map(function(i,a){t.index==a&&(i.doorType_title=e,i.doorType=o.dictValue,i.doorType=o.dictValue)}),this.showDoorType=!1},onConfirmMachineType:function(e){this.machineType=e;var t=this.autoMachineAll.find(function(t){if(t.dictLabel==e)return t});this.machinePrice=t.extraValue,this.machineValue=t.dictValue,this.showMachineType=!1},onConfirmAirEle:function(e){this.airEleType=e;var t=this.hotelElecDevAll.find(function(t){if(t.dictLabel==e)return t});this.airElePrice=t.extraValue,this.airEleValue=t.dictValue,this.showAirEle=!1},onConfirmGateWay:function(e){this.gateWayType=e;var t=this.hotelGateWayAll.find(function(t){if(t.dictLabel==e)return t});this.gateWayPrice=t.extraValue,this.gateWayValue=t.dictValue,this.showGateWay=!1},onConfirmTime:function(e){this.time=e,this.showTime=!1},onConfirm:function(){},openShowRooms:function(){var e=this;this.showRooms=!0,this.allRoomsStatus=!1,this.allRooms.length>0&&(this.choosedIds=this.allRooms.map(function(e){return e.roomId||e.id}),this.id&&0==this.nothingID?(this.addAllRooms=this.addAllRooms.filter(function(t){return!e.choosedIds.includes(t.id)}),this.nothingID=!0):this.addAllRooms=this.addAllRooms.filter(function(t){return!e.choosedIds.includes(t.id)}))},chooseAllRooms:function(){var e=this;this.addAllRooms.map(function(t){t.status=1!=e.allRoomsStatus}),this.allRoomsStatus=!this.allRoomsStatus},chooseRoom:function(e){this.addAllRooms.map(function(t){t.id==e.id&&(t.status=!t.status)})},choosedRooms:function(){if(0==this.addAllRooms.some(function(e){return 1==e.status}))Object(n.c)("至少选择一个房间号");else{var e=this.addAllRooms.filter(function(e){if(1==e.status)return e.lockType_title="锁类型",e.installType_title="装锁方式",e.doorType_title="开门类型",e});this.allRooms=this.allRooms.concat(e),this.showRooms=!1}},goNext:function(e,t){var o=this;if(1==this.showFloor){var i=this.allRooms.filter(function(e){return e.hotelLockType&&e.lockInstall&&e.doorType?e:e.lockType&&e.installType&&e.doorType?e:void 0});if(i.length>=0&&this.allRooms.length!=i.length)return void Object(n.c)("请选择房间信息");this.lockInfo=[],i.map(function(e){var t={};t.roomId=e.id||e.roomId,t.roomSn=e.roomSn,t.price=e.price,t.lockType=e.lockType||e.hotelLockType,t.installType=e.installType||e.lockInstall,t.doorType=e.doorType,o.lockInfo.push(t)}),this.totlePrice_lock=this.lockInfo.reduce(function(e,t){return Number(e)+Number(t.price)},0)}else this.totlePrice_lock=0;this.devInfo=[];var l={};"无"!=this.machineType&&"无"!=this.machineType&&(l.devName=this.machineType,l.devValue=this.machineValue,l.price=this.machinePrice,l.num=this.machineStepper,l.type="machine_type",this.devInfo.push(l));var c={};"无"!=this.airEleType&&"请选择型号"!=this.airEleType&&(c.devName=this.airEleType,c.devValue=this.airEleValue,c.price=this.airElePrice,c.num=this.airEleStepper,c.type="airEle_type",this.devInfo.push(c));var r={};"无"!=this.gateWayType&&"请选择型号"!=this.gateWayType&&(r.devName=this.gateWayType,r.devValue=this.gateWayValue,r.price=this.gateWayPrice,r.num=this.gateWayStepper,r.type="gateWay_type",this.devInfo.push(r)),this.totlePrice_airEle=this.devInfo.reduce(function(e,t){return Number(e)+Number(t.price)*Number(t.num)},0),this.materialInfo=[],this.materielTypes.map(function(e){var t={};t.devName=e.dictLabel||e.devName,t.devValue=e.dictValue||e.devValue,t.num=e.num,t.price=e.extraValue||e.price,o.materialInfo.push(t)}),this.totlePrice_material=this.materialInfo.reduce(function(e,t){return Number(e)+Number(t.price)*Number(t.num)},0);var d={auditApprovalId:this.$route.query.auditApprovalId,hotelId:this.$route.query.applyHotelId,totalPrice:this.totlePrice_lock+this.totlePrice_airEle+this.totlePrice_material,lockInfo:0==this.showFloor?"":a()(this.lockInfo),devInfo:this.devInfo.length>0?a()(this.devInfo):"",materialInfo:a()(this.materialInfo)};"1"==this.isEdit?(delete d.auditApprovalId,delete d.hotelId,d.id=this.id,Object(s.p)(d).done(function(i){n.c.success(i.msg),"edit"==t&&o.$router.push({path:e,query:{type:t,role:o.$route.query.role,applyHotelId:o.$route.query.applyHotelId,applyType:o.$route.query.applyType,hotelId:o.$route.query.hotelId,auditApprovalId:o.$route.query.auditApprovalId}})})):(delete d.id,Object(s.o)(d).done(function(i){d.auditApprovalId=o.$route.query.auditApprovalId,d.hotelId=o.$route.query.hotelId,n.c.success(i.msg),"edit"==t?o.$router.push({path:e,query:{type:t,role:o.$route.query.role,applyHotelId:o.$route.query.applyHotelId,applyType:o.$route.query.applyType,hotelId:o.$route.query.hotelId,auditApprovalId:o.$route.query.auditApprovalId}}):(o.isEdit,o.getType(),o.getLockInfo())}))}}},p={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"addEquipment"}},[i("div",{staticClass:"p10"},[i("div",{staticClass:"top_title"},[e._m(0),e._v(" "),i("div",{on:{click:function(t){e.showFloor=!e.showFloor}}},[i("span",{style:{opacity:0==e.showFloor?"0.3":""}},[e._v("更换门锁")]),e._v(" "),e.showFloor?i("img",{staticClass:"chooseIcon",attrs:{src:o("g+nT"),alt:""}}):i("img",{staticClass:"chooseIcon",staticStyle:{opacity:"0.2"},attrs:{src:o("SJ61"),alt:""}})])]),e._v(" "),1==e.showFloor?i("div",[e._l(e.allRooms,function(t,a){return i("div",{key:a,staticClass:"room"},[i("div",{staticStyle:{width:"20%","text-align":"left"}},[e._v(e._s(t.roomSn))]),e._v(" "),i("div",{staticStyle:{width:"24%"},style:{color:t.hotelLockType||t.lockType?"":"#888"},on:{click:function(t){return e.showAll(a,"lock")}}},[e._v("\n          "+e._s(e.lockInstallTypeObj[t.lockType]||e.lockInstallTypeObj[t.hotelLockType]||t.lockType_title)+"\n          "),i("img",{staticClass:"rightIcon",attrs:{src:o("jkz5"),alt:""}})]),e._v(" "),i("div",{staticStyle:{width:"20%"},style:{color:t.lockInstall||t.installType?"":"#888"},on:{click:function(t){return e.showAll(a,"order")}}},[e._v("\n          "+e._s(e.lockTypeObj[t.installType]||e.lockTypeObj[t.lockInstall]||t.installType_title)+"\n          "),i("img",{staticClass:"rightIcon",attrs:{src:o("jkz5"),alt:""}})]),e._v(" "),e.doorTypesAll.length>0?i("div",{staticStyle:{width:"24%"},style:{color:t.doorType?"":"#888"},on:{click:function(t){return e.showAll(a,"open")}}},[e._v("\n          "+e._s(e.doorTypeObj[t.doorType]||t.doorType_title)+"\n          "),i("img",{staticClass:"rightIcon",attrs:{src:o("jkz5"),alt:""}})]):e._e()])}),e._v(" "),i("div",{staticClass:"addroomIcon",on:{click:e.openShowRooms}},[e._v("添加房间")])],2):e._e()]),e._v(" "),i("div",{staticClass:"p10"},[e._m(1),e._v(" "),i("van-cell-group",[i("div",{staticClass:"stepper_flex"},[i("van-cell",{attrs:{title:"自助机","is-link":"",label:"¥"+e.machinePrice+"/套"},on:{click:function(t){e.showMachineType=!0}},model:{value:e.machineType,callback:function(t){e.machineType=t},expression:"machineType"}}),e._v(" "),"无"!=e.machineType?i("van-stepper",{model:{value:e.machineStepper,callback:function(t){e.machineStepper=t},expression:"machineStepper"}}):e._e()],1),e._v(" "),i("div",{staticClass:"stepper_flex"},[i("van-cell",{attrs:{title:"空调电控","is-link":"",label:"¥"+e.airElePrice+"/套"},on:{click:function(t){e.showAirEle=!0}},model:{value:e.airEleType,callback:function(t){e.airEleType=t},expression:"airEleType"}}),e._v(" "),"无"!=e.airEleType?i("van-stepper",{model:{value:e.airEleStepper,callback:function(t){e.airEleStepper=t},expression:"airEleStepper"}}):e._e()],1),e._v(" "),i("div",{staticClass:"stepper_flex"},[i("van-cell",{attrs:{title:"智能网关","is-link":"",label:"¥"+e.gateWayPrice+"/套"},on:{click:function(t){e.showGateWay=!0}},model:{value:e.gateWayType,callback:function(t){e.gateWayType=t},expression:"gateWayType"}}),e._v(" "),"无"!=e.gateWayType?i("van-stepper",{model:{value:e.gateWayStepper,callback:function(t){e.gateWayStepper=t},expression:"gateWayStepper"}}):e._e()],1)])],1),e._v(" "),i("div",{staticClass:"p10"},[e._m(2),e._v(" "),i("div",{staticStyle:{"margin-bottom":"50px"}},e._l(e.materielTypes,function(t,o){return i("div",{key:o},[i("div",{staticStyle:{"border-bottom":"1px solid #eee"}},[i("div",{staticClass:"m_box"},[i("div",{staticStyle:{"text-align":"left",width:"70%"}},[i("div",[e._v(e._s(t.dictLabel||t.devName))]),e._v(" "),i("div",{staticClass:"c_98"},[e._v("¥"+e._s(t.extraValue||t.price)+"/套")])]),e._v(" "),i("div",[i("van-stepper",{attrs:{min:"0"},model:{value:t.num,callback:function(o){e.$set(t,"num",o)},expression:"item.num"}})],1)]),e._v(" "),"QR"==t.dictValue||"QR"==t.devValue?i("div",{staticClass:"code_box"},e._l(e.codeSuit,function(t,o){return i("div",{key:o,staticClass:"code_type"},[i("div",{staticStyle:{width:"80%"}},[e._v(e._s(t.dictLabel))]),e._v(" "),i("div",[e._v("*"+e._s(t.extraValue>"0"?t.extraValue:e.allRooms.length))])])}),0):e._e()])])}),0)]),e._v(" "),i("div",{staticClass:"flex bottom_box"},[i("div",{staticClass:"bottom_l",on:{click:function(t){return e.goNext("/edit-or-see-apply","keep")}}},[e._v("保存信息")]),e._v(" "),i("div",{staticClass:"bottom_l bottom_r",on:{click:function(t){return e.goNext("/edit-or-see-apply","edit")}}},[e._v("下一步")])]),e._v(" "),i("van-popup",{attrs:{round:"",position:"bottom"},model:{value:e.showLockType,callback:function(t){e.showLockType=t},expression:"showLockType"}},[i("van-picker",{attrs:{title:"智能锁类型","show-toolbar":"",columns:e.lockTypes},on:{confirm:e.onConfirmLockType,cancel:function(t){e.showLockType=!1}}})],1),e._v(" "),i("van-popup",{attrs:{round:"",position:"bottom"},model:{value:e.showDoorInstall,callback:function(t){e.showDoorInstall=t},expression:"showDoorInstall"}},[i("van-picker",{attrs:{title:"装锁方式","show-toolbar":"",columns:e.doorInstalls},on:{confirm:e.onConfirmDoorInstalls,cancel:function(t){e.showDoorInstall=!1}}})],1),e._v(" "),i("van-popup",{attrs:{round:"",position:"bottom"},model:{value:e.showDoorType,callback:function(t){e.showDoorType=t},expression:"showDoorType"}},[i("van-picker",{attrs:{title:"开门类型","show-toolbar":"",columns:e.doorTypes},on:{confirm:e.onConfirmDoorTypes,cancel:function(t){e.showDoorType=!1}}})],1),e._v(" "),i("van-popup",{attrs:{round:"",position:"bottom"},model:{value:e.showMachineType,callback:function(t){e.showMachineType=t},expression:"showMachineType"}},[i("van-picker",{attrs:{title:"自助机","show-toolbar":"",columns:e.autoMachine},on:{confirm:e.onConfirmMachineType,cancel:function(t){e.showMachineType=!1}}})],1),e._v(" "),i("van-popup",{attrs:{round:"",position:"bottom"},model:{value:e.showAirEle,callback:function(t){e.showAirEle=t},expression:"showAirEle"}},[i("van-picker",{attrs:{title:"空调电控","show-toolbar":"",columns:e.hotelElecDev},on:{confirm:e.onConfirmAirEle,cancel:function(t){e.showAirEle=!1}}})],1),e._v(" "),i("van-popup",{attrs:{round:"",position:"bottom"},model:{value:e.showGateWay,callback:function(t){e.showGateWay=t},expression:"showGateWay"}},[i("van-picker",{attrs:{title:"智能网关","show-toolbar":"",columns:e.hotelGateWay},on:{confirm:e.onConfirmGateWay,cancel:function(t){e.showGateWay=!1}}})],1),e._v(" "),i("van-popup",{attrs:{round:"",position:"bottom"},model:{value:e.showTime,callback:function(t){e.showTime=t},expression:"showTime"}},[i("van-picker",{attrs:{title:"时间","show-toolbar":"",columns:e.times},on:{confirm:e.onConfirmTime,cancel:function(t){e.showTime=!1}}})],1),e._v(" "),i("van-popup",{staticStyle:{"line-height":"50px"},attrs:{position:"bottom"},model:{value:e.showRooms,callback:function(t){e.showRooms=t},expression:"showRooms"}},[e.addAllRooms.length>0?i("div",{staticClass:"flex",staticStyle:{"border-bottom":"4px solid #F6F3F6"}},[i("div",{staticClass:"flex",staticStyle:{"padding-left":"120px"}},[i("div",[e._v("选择房间号")]),e._v(" "),i("div",{staticClass:"flex",on:{click:e.chooseAllRooms}},[i("div",{staticStyle:{padding:"0 10px 0 60px"}},[e._v("全选")]),e._v(" "),1==e.allRoomsStatus?i("img",{staticClass:"chooseIcon",attrs:{src:o("g+nT"),alt:""}}):i("img",{staticClass:"chooseIcon",staticStyle:{opacity:"0.2"},attrs:{src:o("SJ61"),alt:""}})])])]):e._e(),e._v(" "),e.addAllRooms.length>0?i("div",{staticClass:"room_box_scroll"},e._l(e.addAllRooms,function(t,a){return i("div",{key:a,staticClass:"room_info",on:{click:function(o){return e.chooseRoom(t)}}},[i("div",{staticStyle:{"padding-right":"20px"}},[e._v(e._s(t.roomSn))]),e._v(" "),1==t.status?i("img",{staticClass:"chooseIcon",attrs:{src:o("g+nT"),alt:""}}):i("img",{staticClass:"chooseIcon",staticStyle:{opacity:"0.2"},attrs:{src:o("SJ61"),alt:""}})])}),0):i("div",{staticStyle:{color:"red","line-height":"80px"}},[e._v("暂无房间,请帮助酒店新建房间号")]),e._v(" "),i("div",{staticClass:"flex",staticStyle:{"border-top":"4px solid #F6F3F6"}},[i("div",{staticClass:"border_eee",style:{width:e.addAllRooms.length>0?"50%":"100%"},on:{click:function(t){e.showRooms=!1}}},[e._v(e._s(e.addAllRooms.length>0?"取消":"确定"))]),e._v(" "),e.addAllRooms.length>0?i("div",{staticClass:"border_eee",staticStyle:{color:"#f60"},on:{click:e.choosedRooms}},[e._v("确定")]):e._e()])])],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"title_left"},[t("div",{staticClass:"c_title"}),this._v(" "),t("div",[this._v("智能门锁")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"top_title"},[t("div",{staticClass:"title_left"},[t("div",{staticClass:"c_title",staticStyle:{background:"#FF7A41"}}),this._v(" "),t("div",[this._v("智慧设备")])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"top_title"},[t("div",{staticClass:"title_left"},[t("div",{staticClass:"c_title",staticStyle:{background:"#05B96C"}}),this._v(" "),t("div",[this._v("物料")])])])}]};var u=o("k6Sl")(d,p,!1,function(e){o("iKRm")},"data-v-7769a016",null);t.default=u.exports},iKRm:function(e,t){}});
//# sourceMappingURL=77.1d91ffd3b4227f3a03361758781501818.js.map