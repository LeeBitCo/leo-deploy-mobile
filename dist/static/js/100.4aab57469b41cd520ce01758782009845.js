webpackJsonp([100],{"5zKh":function(e,t){},Rhnm:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("HkQL"),o=i.n(s),a=i("RmFe"),r=i.n(a),d=i("UJbh"),c=i("Gwi0"),n=i("wWbh"),l=i("s/fh"),u={data:function(){return{price:null,roundTime:null,minDate:new Date,maxDate:new Date,startT:null,endT:null,isShow:!1,show_sTime:!1,show_eTime:!1,dataForm:{cooperOrderId:this.$route.query.cooperOrderId,cooperOrderRoomId:this.$route.query.cooperOrderRoomId,rentalBillId:this.$route.query.rentalBillId||null,roomPrice:null,startTime:null,endTime:null},lifeTypes:{},lifeCosts:[],lifeCostAll:[],lifeCostLists:[],editPrice:{},obj:{1:"电",2:"水",3:"气"},unit:{1:"元/度",2:"元/吨",3:"元/m³"},unit1:{1:"度",2:"吨",3:"m³"},addShow:!1,addPrice:"",addObjShow:!1,show_lifeCostPay:!1,columns:[],payAll:[],title:"",dictSort:"",objItem:"",detailPrice:"",preDegree:null,degree:null,lifeCost_mode:null,add_or_edeit:null,checkType:null}},filters:{filterPrice:function(e){return Number(e).toFixed(2)}},created:function(){this.$store.commit("setHeader",this.$route.query.rentalBillId?"编辑账单":"添加账单"),"生活账单"==this.$route.query.title&&(this.getMore(),this.dataForm.startTime=r()(this.$route.query.startTime).format("YYYY-MM-DD"),this.dataForm.endTime=r()(this.$route.query.endTime).format("YYYY-MM-DD")),this.$route.query.rentalBillId&&"房租账单"==this.$route.query.title&&(this.isShow=!0,this.dataForm.startTime=this.$route.query.startTime,this.dataForm.endTime=this.$route.query.endTime,this.dataForm.roomPrice=this.$route.query.roomPrice)},methods:{openS:function(){this.minDate=new Date(r()().format("YYYY-MM-DD")),this.maxDate=new Date(r()().add(2,"year").format("YYYY-MM-DD")),this.isShow=!1,this.show_sTime=!0},onInputBeforeTime:function(e){this.dataForm.startTime=r()(e).format("YYYY-MM-DD"),this.minDate=new Date(r()(e).add(1,"day").format("YYYY-MM-DD")),this.show_sTime=!1,this.show_eTime=!0},onInputAfterTime:function(e){this.dataForm.endTime=r()(e).format("YYYY-MM-DD"),this.show_eTime=!1,this.isShow=!0},getMore:function(){var e=this;Object(d.a)({dictType:"tb_business_life_cost_mode"}).done(function(t){e.payOldAll=t.data,e.payAll=t.data.map(function(e){return e.dictLabel}),e.lifeCost_mode=e.payOldAll[0].dictLabel}),Object(d.a)({dictType:"business_life_cost"}).done(function(t){e.oldLifeCosts=t.data,e.lifeCostAll=t.data.map(function(e){return e.dictLabel}),e.title=e.oldLifeCosts[0].dictLabel,e.lifeTypes={},t.data.map(function(t){e.lifeTypes[t.dictSort]=t.dictLabel})})},clearNoNum:function(e,t){(e=(e=(e=(e=(e=e.toString()).replace(/[^\d.]/g,"")).replace(/\.{2,}/g,".")).replace(".","$#$").replace(/\./g,"").replace("$#$",".")).replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3")).indexOf(".")<0&&""!=e&&(e=parseFloat(e)),"price"==t?this.addPrice=e:"lastNum"==t?this.preDegree=e:"nowNum"==t&&(this.degree=e)},addRight:function(e){var t=this;if(this.add_or_edeit=e,this.lifeCostLists.length>0){var i=[];this.oldLifeCosts.forEach(function(e){t.lifeCostLists.map(function(e){return e.checkType}).includes(e.dictSort)||i.push(e.dictLabel)}),this.lifeCostAll=i}this.lifeCostAll.length>0?(this.addShow=!0,this.title=this.lifeCostAll[0],this.checkType=this.oldLifeCosts.find(function(e){return e.dictLabel==t.title}).dictSort,this.objItem="",this.addPrice="",this.preDegree="",this.degree=""):Object(l.c)({message:"暂无可添加费用项目",duration:900})},onConfirm:function(e){this.title=e,this.checkType=this.oldLifeCosts.find(function(t){return t.dictLabel==e}).dictSort,this.addObjShow=!1},onConfirmCostPayType:function(e){this.lifeCost_mode=e;var t=this.payOldAll.find(function(t){return t.dictLabel==e}).dictValue;1==this.checkType?this.elecMode=t:2==this.checkType?this.waterMode=t:3==this.checkType&&(this.gasMode=t),this.show_lifeCostPay=!1},addSure:function(){var e=this;this.addPrice?this.checkType<4&&!this.preDegree&&"抄表计算"==this.lifeCost_mode&&"add"==this.add_or_edeit?Object(l.c)({message:"请输入上次读数",duration:900}):this.objItem?(this.lifeCostLists.find(function(t){return t.checkType==e.objItem.checkType}).price=Number(this.addPrice).toFixed(2),this.lifeCostLists.find(function(t){return t.checkType==e.objItem.checkType}).degree=Number(this.degree).toFixed(2),this.lifeCostLists.find(function(t){return t.checkType==e.objItem.checkType}).preDegree=Number(this.preDegree).toFixed(2),this.addShow=!1):this.addSave():Object(l.c)({message:"请输入单价",duration:900})},addSave:function(){var e={checkType:this.checkType,price:Number(this.addPrice).toFixed(2)};this.checkType<4&&(e.preDegree=Number(this.preDegree).toFixed(2),e.degree=Number(this.degree).toFixed(2)),1==this.checkType?(e.elecMode=this.lifeCost_mode,"2"==this.lifeCost_mode&&(delete e.degree,delete e.preDegree)):2==this.checkType?(e.waterMode=this.lifeCost_mode,"2"==this.lifeCost_mode&&(delete e.degree,delete e.preDegree)):3==this.checkType&&(e.gasMode=this.lifeCost_mode,"2"==this.lifeCost_mode&&(delete e.degree,delete e.preDegree)),this.lifeCostLists.push(e),this.addShow=!1},remove:function(e){this.lifeCostLists=this.lifeCostLists.filter(function(t){return t.checkType!=e.checkType})},setItem:function(e,t){this.add_or_edeit=t,e.checkType<4&&(this.addShow=!0,this.objItem=e,this.preDegree=Number(this.objItem.preDegree).toFixed(2),this.addPrice=Number(this.objItem.price).toFixed(2),"0.00"==this.objItem.degree?this.degree="":this.degree=Number(this.objItem.degree).toFixed(2),this.checkType=this.objItem.checkType,1==this.objItem.checkType?this.lifeCost_mode=this.objItem.elecMode:2==this.objItem.checkType?this.lifeCost_mode=this.objItem.waterMode:3==this.objItem.checkType&&(this.lifeCost_mode=this.objItem.gasMode),this.detailPrice=(this.Degree-this.preDegree)*this.addPrice)},saveBack:function(){var e=this,t={};t.id=this.$route.query.lifeCostBillId,this.lifeCostLists.map(function(i){i.dictSort<4&&(1==i.dictSort&&"1"==i.elecMode?(t.elecDegree=e.lifeCostLists.find(function(e){return 1==e.dictSort}).Degree,t.elecMode=i.elecMode):2==i.dictSort&&"1"==i.waterMode?(t.waterDegree=e.lifeCostLists.find(function(e){return 2==e.dictSort}).Degree,t.waterMode=i.waterMode):3==i.dictSort&&"1"==i.gasMode&&(t.gasDegree=e.lifeCostLists.find(function(e){return 3==e.dictSort}).Degree,t.gasMode=i.gasMode)),t[i.dictValue]=i.Price}),MessageBox.confirm("",{message:"确认提交账单？",title:"提示",cancelButtonText:"取消",confirmButtonText:"确定"}).then(function(e){"confirm"==e&&Object(c._38)(t).done(function(e){Object(l.c)({message:e.msg,duration:900}),setTimeout("window.history.go(-1)",900),localStorage.removeItem("life_fee")})}).catch(function(e){console.log(e)})},sure:function(){var e=this;if("房租账单"==this.$route.query.title){if(!this.dataForm.startTime||!this.dataForm.endTime)return void Object(l.c)({message:"请选择时间",duration:900});if(!this.dataForm.roomPrice)return void Object(l.c)({message:"请输入金额",duration:900});this.$route.query.rentalBillId?this.$route.query.rentalBillId&&Object(n.i)(this.dataForm).done(function(e){Object(l.c)({message:e.msg,duration:900}),setTimeout("window.history.go(-1)",900)}):(delete this.dataForm.rentalBillId,Object(n.h)(this.dataForm).done(function(e){Object(l.c)({message:e.msg,duration:900}),setTimeout("window.history.go(-1)",900)}))}else{var t=[];this.lifeCostLists.map(function(i){var s={};i.dictValue=e.oldLifeCosts.find(function(e){return e.dictSort==i.checkType}).dictValue,i.checkType<4?("固定收取"!=i.elecMode&&"固定收取"!=i.waterMode&&"固定收取"!=i.gasMode||(delete i.degree,delete i.preDegree),i.elecMode?(i.mode=e.payOldAll.find(function(e){return e.dictLabel==i.elecMode}).dictValue,delete i.elecMode):i.waterMode?(i.mode=e.payOldAll.find(function(e){return e.dictLabel==i.waterMode}).dictValue,delete i.waterMode):i.gasMode&&(i.mode=e.payOldAll.find(function(e){return e.dictLabel==i.gasMode}).dictValue,delete i.gasMode),delete i.checkType,s[i.dictValue]=i):s[i.dictValue]=i,t.push(s)}),this.aaaaobj={},t=t.map(function(t){for(var i in t)"waterPrice"==t[i].dictValue||"elecPrice"==t[i].dictValue||"gasPrice"==t[i].dictValue?(delete t[i].dictValue,e.aaaaobj[i]=t[i]):(delete t[i].dictValue,e.aaaaobj[i]=t[i].price)});var i={cooperOrderRoomId:this.dataForm.cooperOrderRoomId,lifeCost:o()(this.aaaaobj)};Object(n.g)(i).done(function(e){Object(l.c)({message:e.msg,duration:900}),setTimeout("window.history.go(-1)",900)})}}}},h={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{},[s("van-field",{staticStyle:{"margin-top":"10px","font-size":"0.8rem"},attrs:{label:"账单类型",readonly:"",value:e.$route.query.title}}),e._v(" "),"生活账单"==e.$route.query.title?s("div",{staticClass:"round"},[s("div",[e._v("缴费周期")]),e._v(" "),s("div",{staticStyle:{color:"#989898"}},[e._v(e._s(e._f("dataFilter")(e.dataForm.startTime,"YYYY.MM.DD"))+" ~ "+e._s(e._f("dataFilter")(e.dataForm.endTime,"YYYY.MM.DD")))])]):e._e(),e._v(" "),"生活账单"==e.$route.query.title?s("div",{staticClass:"round_title"},[e._v("\n    生活缴费周期和房租账单周期同步，不支持修改。\n  ")]):e._e(),e._v(" "),"房租账单"==e.$route.query.title?s("div",{staticClass:"round",staticStyle:{padding:"12px 16px 8px"},on:{click:e.openS}},[s("div",[e._v("缴费周期")]),e._v(" "),0==e.isShow?s("div",{staticStyle:{color:"#989898"}},[e._v("点击选择时间段\n      "),s("van-icon",{staticStyle:{"vertical-align":"middle"},attrs:{name:"arrow"}})],1):s("div",{staticStyle:{color:"#ff7e40"}},[e._v(e._s(e._f("dataFilter")(e.dataForm.startTime,"YYYY.MM.DD"))+" ~ "+e._s(e._f("dataFilter")(e.dataForm.endTime,"YYYY.MM.DD"))+"\n      "),s("van-icon",{staticStyle:{"vertical-align":"middle"},attrs:{name:"arrow"}})],1)]):e._e(),e._v(" "),s("div",{attrs:{id:"bottom"},on:{click:e.sure}},[e._v("确定")]),e._v(" "),"房租账单"==e.$route.query.title?s("van-field",{staticStyle:{"margin-top":"20px"},attrs:{label:"账单金额",type:"number",placeholder:"请输入金额",value:e.price},model:{value:e.dataForm.roomPrice,callback:function(t){e.$set(e.dataForm,"roomPrice",t)},expression:"dataForm.roomPrice"}}):e._e(),e._v(" "),"生活账单"==e.$route.query.title?s("div",{staticClass:"editBox"},[s("div",{staticClass:"local_info"},[s("span",[e._v("费用项目")]),e._v(" "),s("img",{staticClass:"img_add_delete",attrs:{src:i("6m+W"),alt:""},on:{click:function(t){return e.addRight("add")}}})]),e._v(" "),s("div",e._l(e.lifeCostLists,function(t){return s("table",{key:t.id,staticClass:"info_box",style:{padding:t.checkType<4?"4px 20px":"14px 20px"}},[s("tr",[s("td",[s("img",{staticClass:"img_add_delete",attrs:{src:i("/hLb"),alt:""},on:{click:function(i){return e.remove(t)}}}),e._v(" "),s("div",{staticClass:"price_unit"},[s("div",[s("span",{staticClass:"three",class:t.checkType<4?"w000":"",style:{"padding-bottom":t.checkType<4?"0.2rem":"0"}},[e._v(e._s(e.lifeTypes[t.checkType]))]),e._v(" "),"1"==t.checkType&&"抄表计算"==t.elecMode||"2"==t.checkType&&"抄表计算"==t.waterMode||"3"==t.checkType&&"抄表计算"==t.gasMode?s("span",[e._v(e._s(t.price)+e._s(e.unit[t.checkType]))]):e._e()]),e._v(" "),"1"==t.checkType&&"抄表计算"==t.elecMode||"2"==t.checkType&&"抄表计算"==t.waterMode||"3"==t.checkType&&"抄表计算"==t.gasMode?s("div",[t.preDegree?s("span",[e._v("本期用"+e._s(e.obj[t.checkType])+":")]):e._e(),e._v(" "),t.preDegree?s("span",[e._v("\n                  0 "+e._s(e.unit1[t.checkType])+" ("+e._s(t.preDegree)+"-"+e._s(t.preDegree)+")")]):e._e()]):s("div")])]),e._v(" "),"1"==t.checkType&&"抄表计算"==t.elecMode||"2"==t.checkType&&"抄表计算"==t.waterMode||"3"==t.checkType&&"抄表计算"==t.gasMode?s("td",{staticClass:"f14",on:{click:function(i){return e.setItem(t,"edit")}}},[(t.degree-t.preDegree)*t.price<0?s("span",{staticClass:"c000"},[e._v("0")]):s("span",{staticClass:"c000"},[e._v(e._s(((t.degree-t.preDegree)*t.price).toFixed(2)))]),e._v(" "),s("van-icon",{staticClass:"cb2",attrs:{name:"arrow"}})],1):s("td",{staticClass:"f14",on:{click:function(i){return e.setItem(t,"edit")}}},[s("span",[s("span",{staticClass:"c000"},[e._v(e._s(t.price))]),e._v(" "),"1"==t.checkType?s("span",[e._v(e._s("预付费模式"==t.elecMode?e.unit1[t.checkType]:"元"))]):e._e(),e._v(" "),"2"==t.checkType?s("span",[e._v(e._s("预付费模式"==t.waterMode?e.unit1[t.checkType]:"元"))]):e._e(),e._v(" "),"3"==t.checkType?s("span",[e._v(e._s("预付费模式"==t.gasMode?e.unit1[t.checkType]:"元"))]):e._e(),e._v(" "),t.checkType<"4"?s("van-icon",{staticClass:"cb2",attrs:{name:"arrow"}}):e._e()],1)])])])}),0)]):e._e(),e._v(" "),s("van-popup",{staticClass:"addBox",model:{value:e.addShow,callback:function(t){e.addShow=t},expression:"addShow"}},[s("div",[e.objItem?s("p",{staticClass:"add-title"},[e._v(e._s(e.obj[e.objItem.checkType])+"费详情")]):s("p",{staticClass:"add-title"},[e._v("添加费用")]),e._v(" "),e.objItem?e._e():s("div",{staticClass:"add-obj"},[s("div",[e._v("费用项目")]),e._v(" "),s("div",{on:{click:function(t){e.addObjShow=!0}}},[s("span",[e._v(e._s(e.title))]),e._v(" "),s("van-icon",{staticClass:"cb2",attrs:{name:"arrow"}})],1)]),e._v(" "),s("div",{staticClass:"add-obj"},[s("div",[e._v("收费方式")]),e._v(" "),e.checkType<4?s("div",{on:{click:function(t){"add"==e.add_or_edeit&&(e.show_lifeCostPay=!0)}}},[s("span",[e._v(e._s(e.lifeCost_mode))]),e._v(" "),"add"==e.add_or_edeit?s("van-icon",{staticClass:"cb2",attrs:{name:"arrow"}}):e._e()],1):s("div",[e._v("固定收取")])]),e._v(" "),s("div",{staticClass:"add-obj"},[s("span",{staticClass:"w30"},[e._v("单价")]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.addPrice,expression:"addPrice"}],staticClass:"addInput60",attrs:{type:"text",placeholder:"请输入单价"},domProps:{value:e.addPrice},on:{keyup:function(t){return e.clearNoNum(e.addPrice,e.name="price")},input:function(t){t.target.composing||(e.addPrice=t.target.value)}}}),e._v(" "),e.objItem&&"2"==e.objItem.checkType?s("div",{staticClass:"w10"},[e._v("元/月")]):e.objItem&&"2"!=e.objItem.checkType?s("div",{staticClass:"w10"},[e._v(e._s("1"==e.objItem.checkType?e.unit[e.checkType]:e.unit1[e.checkType]))]):e.objItem||"固定收取"!=e.lifeCost_mode?e.objItem||"固定收取"==e.lifeCost_mode?e._e():s("div",{staticClass:"w10"},[e._v(e._s("抄表计算"==e.lifeCost_mode?e.unit[e.checkType]:e.unit1[e.checkType]))]):s("div",{staticClass:"w10"},[e._v("元/月")])]),e._v(" "),e.checkType<4&&"抄表计算"==e.lifeCost_mode?s("div",{staticClass:"add-obj"},[s("span",{staticClass:"w30"},[e._v("上次读数")]),e._v(" "),e.objItem?s("input",{directives:[{name:"model",rawName:"v-model",value:e.preDegree,expression:"preDegree"}],staticClass:"addInput60 cb2",attrs:{readonly:"",type:"text",placeholder:"请输入上次读数"},domProps:{value:e.preDegree},on:{input:function(t){t.target.composing||(e.preDegree=t.target.value)}}}):s("input",{directives:[{name:"model",rawName:"v-model",value:e.preDegree,expression:"preDegree"}],staticClass:"addInput60",attrs:{type:"text",placeholder:"请输入上次读数"},domProps:{value:e.preDegree},on:{keyup:function(t){return e.clearNoNum(e.preDegree,e.name="lastNum")},input:function(t){t.target.composing||(e.preDegree=t.target.value)}}}),e._v(" "),s("div",{staticClass:"w10"})]):e._e(),e._v(" "),e.objItem&&"抄表计算"==e.lifeCost_mode?s("div",{staticClass:"add-obj"},[s("span",{staticClass:"w30"},[e._v("应收费用")]),e._v(" "),e.degree?s("span",{staticClass:"addInput60 c60"},[e._v(e._s(e._f("filterPrice")((e.degree-e.preDegree)*e.addPrice))+" "),s("span",{staticClass:"w10"},[e._v("元")])]):s("span",{staticClass:"addInput60 c60"},[e._v("0  "),s("span",{staticClass:"w10"},[e._v("元")])]),e._v(" "),s("div",{staticClass:"w10"})]):e._e(),e._v(" "),s("div",{staticClass:"add-button"},[s("div",{staticClass:"add-cancle",on:{click:function(t){e.addShow=!1}}},[e._v("取消")]),e._v(" "),s("div",{staticClass:"add-sure",on:{click:e.addSure}},[e._v("确定")])])])]),e._v(" "),s("van-popup",{attrs:{position:"bottom"},model:{value:e.addObjShow,callback:function(t){e.addObjShow=t},expression:"addObjShow"}},[s("van-picker",{attrs:{"show-toolbar":"",columns:e.lifeCostAll},on:{cancel:function(t){e.addObjShow=!1},confirm:e.onConfirm}})],1),e._v(" "),s("van-popup",{attrs:{position:"bottom"},model:{value:e.show_lifeCostPay,callback:function(t){e.show_lifeCostPay=t},expression:"show_lifeCostPay"}},[s("van-picker",{attrs:{"show-toolbar":"",columns:e.payAll},on:{confirm:e.onConfirmCostPayType,cancel:function(t){e.show_lifeCostPay=!1}}})],1),e._v(" "),s("mt-popup",{staticStyle:{width:"100%"},attrs:{position:"bottom"},model:{value:e.show_sTime,callback:function(t){e.show_sTime=t},expression:"show_sTime"}},[s("van-datetime-picker",{attrs:{type:"date",title:"选择开始时间","min-date":e.minDate,"max-date":e.maxDate},on:{cancel:function(t){e.show_sTime=!1},confirm:e.onInputBeforeTime},model:{value:e.startT,callback:function(t){e.startT=t},expression:"startT"}})],1),e._v(" "),s("mt-popup",{staticStyle:{width:"100%"},attrs:{position:"bottom"},model:{value:e.show_eTime,callback:function(t){e.show_eTime=t},expression:"show_eTime"}},[s("van-datetime-picker",{attrs:{type:"date",title:"选择结束时间","min-date":e.minDate,"max-date":e.maxDate},on:{cancel:function(t){e.show_eTime=!1},confirm:e.onInputAfterTime},model:{value:e.endT,callback:function(t){e.endT=t},expression:"endT"}})],1)],1)},staticRenderFns:[]};var m=i("k6Sl")(u,h,!1,function(e){i("5zKh")},"data-v-53cc0e0c",null);t.default=m.exports}});
//# sourceMappingURL=100.4aab57469b41cd520ce01758782009845.js.map