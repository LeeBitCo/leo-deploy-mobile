webpackJsonp([67],{LNT0:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("yFKH"),r=i("s/fh"),s=i("RKje"),n={data:function(){return{show_operation:!1,show_editDepart:!1,departData:null,type:null,title:null,top_input:null,bottom_input:null,deptForm:{parentId:null,id:null,deptName:null},staffForm:{userId:null,deptId:null},edit_or_change:"edit",departmentList:[],departOrderAll:[],deptNameArr:[],departOtherAll:[]}},created:function(){this.deptNameArr=this.$store.state.deptNameArr;for(var t=null,e=0;e<this.deptNameArr.length;e++)if(this.$route.query.parentId==this.deptNameArr[e].id){t=e;break}if(t){var i=this.deptNameArr.filter(function(e,i){return i<t});this.deptNameArr=i}this.getCurrentInfo()},methods:{getCurrentInfo:function(){var t=this;Object(a.d)({parentId:this.$route.query.parentId}).done(function(e){t.departData=e.data,t.departOtherAll=e.other,t.departOrderAll=e.order,t.$nextTick(function(){this.departOtherAll.forEach(function(t){t.avatar||Object(s.a)(40,40,20,"headImage"+t.id,"Img"+t.id,t.realName||t.nickName,1)})}),t.$store.commit("setHeader",t.departData.deptName),0==t.deptNameArr.filter(function(e){return e.id==t.departData.id}).length&&(t.deptNameArr.push(t.departData),t.$store.commit("SET_DEPT_MENU",t.deptNameArr)),t.getdepartAll()})},getdepartAll:function(){var t=this;Object(a.a)().done(function(e){t.departmentList=e.data})},addDepart:function(){var t=this;this.top_input=null,this.title="新建部门",this.bottom_input=this.departmentList.find(function(e){return e.id==t.departData.id}).deptName,this.deptForm.parentId=this.departData.id,this.deptForm.id=null,this.show_editDepart=!0},addPerson:function(t,e){this.$router.push({path:e,query:{deptId:"depart"==t?this.departData.id:this.choosed_item.id,deptName:"depart"==t?this.departData.deptName:this.choosed_item.deptName}})},more:function(t,e){this.bottom_input=null,this.top_input=null,this.deptForm.parentId=null,this.deptForm.id=null,this.deptForm.deptName=null,this.type=t,this.choosed_item=e,this.show_operation=!0},editDepart:function(t){var e=this;this.edit_or_change=t,this.title="edit"==t?"编辑部门":"变更部门","edit"==t?(this.top_input=this.choosed_item.deptName,this.bottom_input=this.departmentList.find(function(t){return t.id==e.departData.id}).deptName,this.deptForm.id=this.choosed_item.id,this.deptForm.parentId=this.departData.id):(this.staffForm.userId=this.choosed_item.id,this.staffForm.deptId=this.departData.id,this.bottom_input=this.departmentList.find(function(t){return t.id==e.departData.id}).deptName),this.show_operation=!1,this.show_editDepart=!0},addChildDepart:function(){this.title="添加子部门",this.bottom_input=this.choosed_item.deptName,this.deptForm.parentId=this.choosed_item.id,this.deptForm.id=null,this.show_operation=!1,this.show_editDepart=!0},addStaff:function(){this.show_operation=!1,this.addPerson("staff","/add-departStaff")},remove:function(){var t=this;"depart"==this.type?Object(a.h)({deptId:this.choosed_item.id}).done(function(e){Object(r.c)(e.msg),t.show_operation=!1,t.getCurrentInfo()}):Object(a.j)({deptId:this.choosed_item.id}).done(function(e){Object(r.c)(e.msg),t.show_operation=!1,t.getCurrentInfo()})},chooseDepartment:function(){var t=this;this.id=this.departmentList.find(function(e){return e.deptName==t.bottom_input}).id,this.staffForm.deptId=this.id,this.staffForm.userId=this.choosed_item.id},goNext:function(t){this.$router.push({path:"/depart-management",query:{parentId:t.id}})},routerGo:function(t){t+=1;var e=this.deptNameArr.length-t;this.$router.go(e)},confirmDepart:function(t,e){var i=this;if("confirm"==t)if("edit"==this.edit_or_change)if(this.deptForm.deptName=this.top_input,this.deptForm.id)Object(a.g)(this.deptForm).done(function(t){e(!1),i.show_editDepart=!1,i.getCurrentInfo()});else{if(!this.top_input)return Object(r.c)("请填写部门名称"),void e(!1);Object(a.f)(this.deptForm).done(function(t){e(!1),i.show_editDepart=!1,i.getCurrentInfo()})}else Object(a.i)(this.staffForm).done(function(t){Object(r.c)(t.msg),e(!1),i.show_editDepart=!1,i.getCurrentInfo()});else"cancel"==t&&(e(!1),this.show_editDepart=!1)}}},o={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"depart_box"}},[a("div",{staticClass:"flex p20"},[t.deptNameArr&&t.deptNameArr.length>0?a("div",{staticStyle:{display:"flex","align-items":"center"}},t._l(t.deptNameArr,function(e,i){return a("div",{key:i,staticStyle:{display:"flex","align-items":"center"}},[t._v(t._s(e.deptName)+"\n        "),a("van-icon",{attrs:{name:"arrow"}})],1)}),0):t._e()]),t._v(" "),a("div",{staticClass:"depart_content"},[t.departOtherAll.length>0?a("div",{staticClass:"depar_center"},t._l(t.departOtherAll,function(e,r){return a("div",{key:r,staticClass:"flex depart_list space"},[a("div",{staticClass:"flex",staticStyle:{"align-items":"end"}},[a("img",{staticStyle:{"border-radius":"50%",width:"25px",height:"25px","margin-right":"6px"},attrs:{id:"Img"+e.id}}),t._v(" "),a("canvas",{staticStyle:{display:"none"},attrs:{id:"headImage"+e.id}}),t._v(" "),a("div",[a("div",[t._v(t._s(e.realName||e.nickName))])])]),t._v(" "),a("div",{staticClass:"flex"},[a("img",{staticClass:"pr12 h16",attrs:{src:i("E1He")},on:{click:function(i){return t.more("staff",e)}}}),t._v(" "),a("van-icon",{staticClass:"font12",attrs:{name:"arrow"}})],1)])}),0):t._e(),t._v(" "),t.departOrderAll.length>0?a("div",{staticClass:"depar_center"},t._l(t.departOrderAll,function(e,r){return a("div",{key:r,staticClass:"flex depart_list space",on:{click:function(i){return t.goNext(e)}}},[a("div",{staticClass:"flex",staticStyle:{"align-items":"end"}},[a("img",{staticClass:"pr12 pt2",attrs:{src:i("T88P")}}),t._v(" "),a("div",[a("div",[t._v(t._s(e.deptName))]),t._v(" "),a("div",{staticClass:"font12"},[t._v(t._s(e.orderNum)+"人")])])]),t._v(" "),a("div",{staticClass:"flex"},[a("img",{staticClass:"pr12 h16",attrs:{src:i("E1He")},on:{click:function(i){return i.stopPropagation(),t.more("depart",e)}}}),t._v(" "),a("van-icon",{staticClass:"font12",attrs:{name:"arrow"}})],1)])}),0):t._e()]),t._v(" "),a("div",{staticClass:"flex depart_bottom"},[a("div",{staticClass:"w50",on:{click:t.addDepart}},[a("van-icon",{staticClass:"pr12",attrs:{color:"#FF7D41",name:"plus"}}),t._v("新建部门\n    ")],1),t._v(" "),a("div",{staticClass:"w50",on:{click:function(e){return t.addPerson("depart","/add-departStaff")}}},[a("van-icon",{staticClass:"pr12",attrs:{color:"#FF7D41",name:"plus"}}),t._v("新建人员\n    ")],1)]),t._v(" "),a("van-popup",{staticClass:"operation_box",attrs:{"close-on-click-overlay":!1,position:"bottom"},model:{value:t.show_operation,callback:function(e){t.show_operation=e},expression:"show_operation"}},[a("div",{staticClass:"operation_content"},["depart"==t.type?a("div",{on:{click:function(e){return t.editDepart("edit")}}},[t._v("编辑部门")]):t._e(),t._v(" "),"depart"==t.type?a("div",{on:{click:t.addChildDepart}},[t._v("添加子部门")]):t._e(),t._v(" "),"depart"==t.type?a("div",{on:{click:t.addStaff}},[t._v("添加人员")]):t._e(),t._v(" "),"staff"==t.type?a("div",{on:{click:function(e){return t.editDepart("change")}}},[t._v("变更部门")]):t._e(),t._v(" "),a("div",{staticStyle:{color:"red"},on:{click:t.remove}},[t._v(t._s("depart"==t.type?"删除部门":"删除员工"))])]),t._v(" "),a("div",{staticClass:"cancel",on:{click:function(e){t.show_operation=!1}}},[t._v("取消")])]),t._v(" "),a("van-dialog",{attrs:{"before-close":t.confirmDepart,title:t.title,"show-cancel-button":""},model:{value:t.show_editDepart,callback:function(e){t.show_editDepart=e},expression:"show_editDepart"}},["edit"==t.edit_or_change?a("div",[a("div",{staticClass:"flex edit_top"},[a("div",{staticClass:"w30"},[t._v("部门名称")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.top_input,expression:"top_input"}],staticClass:"w60 input",attrs:{type:"text",placeholder:"请输入部门名称"},domProps:{value:t.top_input},on:{input:function(e){e.target.composing||(t.top_input=e.target.value)}}})]),t._v(" "),a("div",{staticClass:"flex edit_top"},[a("div",{staticClass:"w30"},[t._v("上级部门")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.bottom_input,expression:"bottom_input"}],staticClass:"w60 input",attrs:{readonly:""},domProps:{value:t.bottom_input},on:{input:function(e){e.target.composing||(t.bottom_input=e.target.value)}}})])]):a("div",[a("div",{staticClass:"flex edit_top"},[a("div",{staticClass:"w30"},[t._v("员工姓名")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.top_input,expression:"top_input"}],staticClass:"w60 input",attrs:{readonly:""},domProps:{value:t.top_input},on:{input:function(e){e.target.composing||(t.top_input=e.target.value)}}})]),t._v(" "),a("div",{staticClass:"flex edit_top"},[a("div",{staticClass:"w30"},[t._v("所属部门")]),t._v(" "),a("select",{directives:[{name:"model",rawName:"v-model",value:t.bottom_input,expression:"bottom_input"}],staticClass:"w60",staticStyle:{border:"none"},on:{change:[function(e){var i=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.bottom_input=e.target.multiple?i:i[0]},t.chooseDepartment]}},t._l(t.departmentList,function(e,i){return a("option",{key:i,domProps:{value:e.deptName}},[t._v(t._s(e.deptName))])}),0)])])])],1)},staticRenderFns:[]};var d=i("k6Sl")(n,o,!1,function(t){i("aGiY")},"data-v-888d279e",null);e.default=d.exports},aGiY:function(t,e){}});
//# sourceMappingURL=67.7f1d5f12075ecea4b4411758781501818.js.map