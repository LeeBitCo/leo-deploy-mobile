webpackJsonp([18,57],{"/3GQ":function(t,e){},Pedn:function(t,e){},qSXn:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={components:{MyOtaState:a("tR8M").default},data:function(){return{otaScale_show:!1,otaScaleList:[]}},created:function(){this.$store.commit("setHeader","测试")},methods:{}},o={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("My-otaState")],1)},staticRenderFns:[]};var n=a("k6Sl")(i,o,!1,function(t){a("Pedn")},"data-v-efebc134",null);e.default=n.exports},tR8M:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a("32Wh"),o=a.n(i),n=a("YC+b"),r=a.n(n),s=a("s/F+"),c=a.n(s),l=a("yrbl"),h=a.n(l),d=a("Gwi0"),u=a("hdnP"),m=a("RmFe"),v=a.n(m),y=a("s/fh"),f={name:"PriceDetail",data:function(){return{scaleName:null,changedPrice:null,changedDate:null,changedMonth:null,changedDate1:null,changedMonth1:null,changedDate2:null,changedMonth2:null,changedYear:null,otaSTime:null,diffDay:null,y:null,ordinaryPrice:null,weekPrice:null,DayPrice:null,bookMonthNum:null,roomScaleRooms:null,startDay:null,endDay:null,virtualRoomScaleId:null,value:"1",saleRadio:"1",LimitedStepper:0,minStepper:0,maxStepper:100,show_roomPrice:!1,show_roomAmount:!1,show_otaScale:!1,show_otaMore:!1,showArray:[],startIndex:[],endIndex:[],otaScaleList:[],weekList:["日","一","二","三","四","五","六"],holiday:["2022-09-10","2022-09-11","2022-09-12"],holidayName:{"2022-09-10":"中秋节","2022-09-11":"中秋节","2022-09-12":"中秋节"}}},created:function(){localStorage.getItem("ota_scaleList")&&(this.otaScaleInfoList=JSON.parse(localStorage.getItem("ota_scaleList")),this.otaScaleList=this.otaScaleInfoList.map(function(t){return t.scaleName})),this.$store.commit("setHeader","房价日历"),this.bookMonthNum=this.$route.query.bookMonth,this.scaleName=this.$route.query.scaleName,this.pro_id=this.$route.query.pro_id,this.scale_id=this.$route.query.scale_id,this.priceDataGet(this.$route.query.virtualRoomScaleId)},methods:{priceDataGet:function(t){var e=this;return h()(c.a.mark(function a(){var i,o,n,r,s,l,h,u,m;return c.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,e.startTime=null,e.endTime=null,e.endDay=null,e.startDay=null,i=null,!e.$route.query.sign){a.next=16;break}return a.next=9,Object(d._16)(t,{otaSource:e.$route.query.otaPlat});case 9:i=a.sent,o=i.data.roomPrices,n=i.data.roomStates,o.map(function(t){n.map(function(e){v()(t.day).unix()==v()(e.day).unix()&&(e.realAmount=t.realAmount)})}),e.dealRes=n,a.next=20;break;case 16:return a.next=18,Object(d._7)(e.pro_id,{roomScaleId:e.scale_id});case 18:i=a.sent,e.dealRes=i.data;case 20:1==i.ret&&(e.roomScaleRooms=e.dealRes,r=e.dealRes.map(function(t){return Number(t.realAmount).toFixed(2)}),s=e.dealRes.map(function(t){return t.roomBook}),l=e.dealRes.map(function(t){return t.roomCount}),h=e.dealRes.map(function(t){return t.maxSaleCount}),u=e.dealRes.map(function(t){return t.virtualRoomBook}),m=e.dealRes.map(function(t){return t.day}),e.nowday=e.dealRes[0].day,e.createArry(Number(e.bookMonthNum)+1,r,s,l,h,u,m)),a.next=26;break;case 23:a.prev=23,a.t0=a.catch(0),console.log(a.t0);case 26:case"end":return a.stop()}},a,e,[[0,23]])}))()},pickScaleName:function(){0!=this.otaScaleList.length&&(this.show_otaScale=!0)},onConfirm:function(t){this.scaleName=t,this.virtualRoomScaleId=this.otaScaleInfoList.find(function(e){return e.scaleName==t}).virtualRoomScaleId,this.show_otaScale=!1,this.priceDataGet(this.virtualRoomScaleId)},createArry:function(t,e,a,i,o,n,r){for(var s=this,c=[],l=v()(),h=void 0,d=0,u=0;u<t;u++){var m={y:(h=v()(this.nowday).format("YYYY-MM-DD")==l.format("YYYY-MM-DD")?0==u?l:l.startOf("month").add(u,"month"):0==u?l.subtract(1,"day"):l.startOf("month").add(u,"month")).year(),m:h.month()+1},y=this.translateToArray(h).map(function(t){if(t.days){var c=s.searchHoliday(t.nowTime),l=s.$route.query.sign?{date:t.days,price:e[d],holiday:c,roomBook:a[d],roomCount:i[d],maxSaleCount:o[d],virtualRoomBook:n[d],time:r[d]}:{date:t.days,price:e[d],holiday:c};return d++,l}return t});c.push({title:m,list:y})}this.showArray=c},searchHoliday:function(t){return this.holiday.includes(t)?this.holidayName[t]||"假日":""},translateToArray:function(t){var e=t.date(),a=t.format("YYYY-MM"),i=t.startOf("month").day(),n=t.endOf("month").date(),s=t.day(),c=n-e+1,l=r()({length:c},function(t,i){var o=(i+e).toString().padStart(2,"0");return{days:i+e,nowTime:a+"-"+o}}),h=Array(s).fill(0),d=Array(42-(n+i)).fill(0);return[].concat(o()(h),o()(l),o()(d))},changePrice:function(t,e,a,i){if(this.LimitedStepper=e.maxSaleCount-e.virtualRoomBook<e.roomCount-e.roomBook?e.maxSaleCount-e.virtualRoomBook:e.maxSaleCount-e.roomBook,this.minStepper=0,this.maxStepper=e.roomCount-e.roomBook,this.info=e,e.price<0)this.show_roomPrice=!1;else{this.changedPrice=e.price,this.changedDate=e.date,this.changedMonth=t.m;var o=this.showArray[a].list[i].date;if("number"==typeof o&&!this.startDay)return this.changedYear=t.y,this.startDay=o,this.changedDate1=this.startDay,this.changedMonth1=t.m,this.startIndex=[a,i],void(this.showArray[a].list[i].date="开始");if("开始"==o&&!this.endDay)return this.changedYear=t.y,this.endDay=this.startDay,this.showArray[a].list[i].date="开始/结束",this.changedDate=this.startDay,this.otaSTime=this.changedYear+"年"+this.changedMonth+"月"+this.changedDate+"日",void(this.$route.query.sign?this.show_otaMore=!0:this.show_roomPrice=!0);if("开始"==o&&this.endDay)return this.changedYear=t.y,this.showArray[a].list[i].date=this.startDay,this.showArray[this.endIndex[0]].list[this.endIndex[1]].date=this.endDay,this.endDay="",void(this.startDay="");if("number"==typeof o&&this.startDay&&!this.endDay&&(a>this.startIndex[0]||a==this.startIndex[0]&&i>this.startIndex[1]))return this.end_month=t.y,this.endDay=o,this.changedDate2=this.endDay,this.changedMonth2=t.m,this.endIndex=[a,i],this.showArray[a].list[i].date="结束",void(this.$route.query.sign?(this.otaSTime=this.changedYear+"-"+this.changedMonth1+"-"+this.changedDate1+"至"+this.changedYear+"-"+this.changedMonth2+"-"+this.changedDate2,this.diffDay=v()(this.changedYear+"-"+this.changedMonth2+"-"+this.changedDate2).diff(v()(this.changedYear+"-"+this.changedMonth1+"-"+this.changedDate1),"day"),this.startTime=v()(this.changedYear+"-"+this.changedMonth1+"-"+this.changedDate1).format("YYYY-MM-DD"),this.endTime=v()(this.changedYear+"-"+this.changedMonth2+"-"+this.changedDate2).format("YYYY-MM-DD"),this.show_otaMore=!0):this.show_roomAmount=!0);if("开始/结束"==o)return this.showArray[a].list[i].date=this.startDay,this.endDay="",void(this.startDay="");if("结束"==o)return this.changedYear=t.y,this.showArray[a].list[i].date=this.endDay,this.showArray[this.startIndex[0]].list[this.startIndex[1]].date=this.startDay,this.endDay="",void(this.startDay="")}},confirmOne:function(t,e){var a=this;if("confirm"==t){if(e(!1),!this.changedPrice)return Object(y.c)("请正确输入日租价格"),void(this.changedPrice="");var i=this.changedYear+"-"+(this.changedMonth<10?"0"+this.changedMonth:this.changedMonth)+"-"+(this.changedDate<10?"0"+this.changedDate:this.changedDate),o=null;o=this.$route.query.sign?this.startTime?{week:0,startTime:this.startTime,endTime:this.endTime,virtualRoomScaleId:this.virtualRoomScaleId||this.$route.query.virtualRoomScaleId,realAmount:this.changedPrice}:{virtualRoomScaleId:this.virtualRoomScaleId||this.$route.query.virtualRoomScaleId,realAmount:this.changedPrice,priceDay:i}:{roomScaleId:this.pro_id,realAmount:this.changedPrice,priceDate:i},(this.$route.query.sign?this.otaSTime&&this.otaSTime.length>10?u.j:u.k:d._80)(o).done(function(t){Object(y.c)({message:t.msg,duration:900}),a.priceDataGet(a.virtualRoomScaleId||a.$route.query.virtualRoomScaleId)}),this.show_roomPrice=!1}else"cancel"==t&&(e(!1),this.priceDataGet(this.virtualRoomScaleId||this.$route.query.virtualRoomScaleId),this.show_roomPrice=!1)},confirmMore:function(t,e){var a=this;if("confirm"==t){if(e(!1),!this.$route.query.sign){if("1"==this.value&&!this.ordinaryPrice)return Object(y.c)("请正确输入平时价格"),void(this.ordinaryPrice=null);if("1"==this.value&&!this.weekPrice)return Object(y.c)("请正确输入周末价格"),void(this.weekPrice=null);if("2"==this.value&&!this.DayPrice)return Object(y.c)("请正确输入日租价格"),void(this.DayPrice=null)}var i=this.changedYear+"-"+(this.changedMonth1<10?"0"+this.changedMonth1:this.changedMonth1)+"-"+(this.changedDate1<10?"0"+this.changedDate1:this.changedDate1),o=this.end_month+"-"+(this.changedMonth2<10?"0"+this.changedMonth2:this.changedMonth2)+"-"+(this.changedDate2<10?"0"+this.changedDate2:this.changedDate2),n=null;n=this.$route.query.sign?{roomScaleId:this.pro_id,maxSaleRoom:"1"==this.saleRadio?this.maxStepper:this.LimitedStepper,otaSource:this.$route.query.otaPlat,stateDate:i}:"1"==this.value?{startTime:i,endTime:o,roomScaleId:this.pro_id,week:this.value,dayAmount:this.ordinaryPrice,weekDayAmount:this.weekPrice}:{startTime:i,endTime:o,roomScaleId:this.pro_id,week:this.value,realAmount:this.DayPrice},(this.$route.query.sign?u.n:d._79)(n).done(function(t){Object(y.c)({message:t.msg,duration:900}),a.ordinaryPrice=null,a.weekPrice=null,a.DayPrice=null,a.priceDataGet(a.virtualRoomScaleId||a.$route.query.virtualRoomScaleId)}),this.show_roomAmount=!1}else"cancel"==t&&(e(!1),this.priceDataGet(this.virtualRoomScaleId||this.$route.query.virtualRoomScaleId),this.show_roomAmount=!1)},goNext:function(t){"1"==t?(this.show_roomPrice=!0,this.show_otaMore=!1):(this.saleRadio="1",this.show_roomAmount=!0,this.show_otaMore=!1)}}},_={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"topbox"},[a("p",{staticClass:"scale",on:{click:t.pickScaleName}},[t._v(t._s(t.scaleName))]),t._v(" "),a("div",t._l(t.showArray,function(e,i){return a("div",{key:i},[a("h4",{staticClass:"time"},[t._v(t._s(e.title.y+"年"+e.title.m+"月"))]),t._v(" "),a("div",[t._l(t.weekList,function(e){return a("div",{key:e,staticClass:"datediv",staticStyle:{"line-height":"50px"}},[t._v(t._s(e))])}),t._v(" "),t._l(e.list,function(o,n){return a("div",{key:n,staticClass:"datediv",style:o.holiday?"background-color:#FFF0F0;box-sizing:border-box;":"border:none",attrs:{id:"choose"+n},on:{click:function(a){return t.changePrice(e.title,o,i,n)}}},[o.price?a("div",[a("div",{staticStyle:{color:"#000","font-size":"12px"}},[t._v(t._s(o.date))]),t._v(" "),o.price>=0?a("div",{staticClass:"money",staticStyle:{color:"#f60"}},[t._v("￥"+t._s(Math.trunc(o.price)))]):t._e(),t._v(" "),a("div",{staticStyle:{"font-size":"12px"}},[t._v(t._s(o.holiday))]),t._v(" "),t.$route.query.sign&&o.date?a("div",[t._v(t._s(o.maxSaleCount-o.virtualRoomBook<o.roomCount-o.roomBook?o.maxSaleCount-o.virtualRoomBook:o.maxSaleCount-o.roomBook)+"间")]):t._e()]):t._e()])})],2)])}),0),t._v(" "),a("van-dialog",{attrs:{title:t.$route.query.sign?"修改房价":"设置"+t.changedMonth+"月"+t.changedDate+"号的房价","before-close":t.confirmOne,"show-cancel-button":""},model:{value:t.show_roomPrice,callback:function(e){t.show_roomPrice=e},expression:"show_roomPrice"}},[t.$route.query.sign?a("div",[a("van-field",{attrs:{label:"渠道房型",readonly:""},model:{value:t.scaleName,callback:function(e){t.scaleName=e},expression:"scaleName"}}),t._v(" "),a("van-field",{attrs:{label:"日期",readonly:""},model:{value:t.otaSTime,callback:function(e){t.otaSTime=e},expression:"otaSTime"}}),t._v(" "),a("van-field",{attrs:{label:"房价",type:"number",placeholder:"请输入房价"},model:{value:t.changedPrice,callback:function(e){t.changedPrice=e},expression:"changedPrice"}}),t._v(" "),a("div",{staticClass:"otaTitle"},[t._v("携程价格按照低价设置，即最终结算给酒店的价格。")])],1):a("van-field",{attrs:{label:"日租价",type:"number",placeholder:"请输入日租价格"},model:{value:t.changedPrice,callback:function(e){t.changedPrice=e},expression:"changedPrice"}})],1),t._v(" "),a("van-dialog",{attrs:{title:t.$route.query.sign?"修改房量":"设置"+t.changedMonth1+"月"+t.changedDate1+"号-"+t.changedMonth2+"月"+t.changedDate2+"号的房价","before-close":t.confirmMore,"show-cancel-button":""},model:{value:t.show_roomAmount,callback:function(e){t.show_roomAmount=e},expression:"show_roomAmount"}},[t.$route.query.sign?a("div",[a("van-field",{attrs:{label:"渠道房型",readonly:""},model:{value:t.scaleName,callback:function(e){t.scaleName=e},expression:"scaleName"}}),t._v(" "),a("van-field",{attrs:{label:"日期范围",readonly:""},model:{value:t.otaSTime,callback:function(e){t.otaSTime=e},expression:"otaSTime"}}),t._v(" "),a("div",{staticClass:"g_radio",staticStyle:{padding:"10px 25px"}},[a("div",{staticStyle:{color:"#646566",width:"70px","text-align":"left"}},[t._v("可售房量")]),t._v(" "),a("van-radio-group",{attrs:{"checked-color":"#ff7d41",direction:"horizontal"},model:{value:t.saleRadio,callback:function(e){t.saleRadio=e},expression:"saleRadio"}},[a("van-radio",{attrs:{name:"1"}},[t._v("无限量")]),t._v(" "),a("van-radio",{attrs:{name:"2"}},[t._v("限量")])],1)],1),t._v(" "),2==t.saleRadio?a("div",{staticClass:"g_radio",staticStyle:{padding:"10px 25px"}},[a("div",{staticStyle:{color:"#646566",width:"70px","text-align":"left"}},[t._v("限量房量")]),t._v(" "),a("van-stepper",{attrs:{min:t.minStepper,max:t.maxStepper},model:{value:t.LimitedStepper,callback:function(e){t.LimitedStepper=e},expression:"LimitedStepper"}})],1):t._e()],1):a("div",[a("van-radio-group",{staticStyle:{margin:"20px 25%"},attrs:{"checked-color":"#ff7d41"},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}},[a("van-radio",{attrs:{name:"1"}},[t._v("平时、周末不同价")]),t._v(" "),a("van-radio",{staticClass:"g_mt10",attrs:{name:"2"}},[t._v("平时、周末统一价")])],1),t._v(" "),"1"==t.value?a("div",{staticClass:"g_flex"},[a("div",{staticStyle:{width:"80%"}},[a("div",[t._v("平时价格")]),t._v(" "),a("div",{staticStyle:{"font-size":"12px"}},[t._v("(周日-周四)")])]),t._v(" "),a("van-field",{attrs:{type:"number",placeholder:"请输入平时价格"},model:{value:t.ordinaryPrice,callback:function(e){t.ordinaryPrice=e},expression:"ordinaryPrice"}})],1):t._e(),t._v(" "),"1"==t.value?a("div",{staticClass:"g_flex"},[a("div",{staticStyle:{width:"80%"}},[a("div",[t._v("周末价格")]),t._v(" "),a("div",{staticStyle:{"font-size":"12px"}},[t._v("(周五-周六)")])]),t._v(" "),a("van-field",{attrs:{type:"number",placeholder:"请输入周末价格"},model:{value:t.weekPrice,callback:function(e){t.weekPrice=e},expression:"weekPrice"}})],1):t._e(),t._v(" "),"2"==t.value?a("div",{staticClass:"g_flex"},[a("div",{staticStyle:{width:"80%"}},[a("div",[t._v("周一到周末价格")]),t._v(" "),a("div",{staticStyle:{"font-size":"12px"}},[t._v("(周日-周四)")])]),t._v(" "),a("van-field",{attrs:{type:"number",placeholder:"请输入日租价格"},model:{value:t.DayPrice,callback:function(e){t.DayPrice=e},expression:"DayPrice"}})],1):t._e()],1)]),t._v(" "),a("van-popup",{staticStyle:{width:"90%","font-size":"14px",padding:"20px 0"},attrs:{round:""},on:{"click-overlay":function(e){return t.priceDataGet(t.virtualRoomScaleId||t.$route.query.virtualRoomScaleId)}},model:{value:t.show_otaMore,callback:function(e){t.show_otaMore=e},expression:"show_otaMore"}},[a("div",[t._v(t._s(t.otaSTime)+" "),t.otaSTime&&t.otaSTime.length>10?a("span",[t._v("共"+t._s(t.diffDay+1)+"晚")]):t._e()]),t._v(" "),a("div",{staticStyle:{margin:"10px 0 30px 0"}},[t._v(t._s(t.scaleName))]),t._v(" "),a("div",[a("van-button",{staticClass:"vanButton",attrs:{color:"#ff7d41"},on:{click:function(e){return t.goNext("1")}}},[t._v("改房价")]),t._v(" "),t.otaSTime&&10==t.otaSTime.length?a("van-button",{staticClass:"vanButton",attrs:{color:"#ff7d41"},on:{click:function(e){return t.goNext("2")}}},[t._v("改房量")]):t._e()],1)]),t._v(" "),a("van-popup",{staticStyle:{width:"100%"},attrs:{position:"bottom"},model:{value:t.show_otaScale,callback:function(e){t.show_otaScale=e},expression:"show_otaScale"}},[a("van-picker",{attrs:{title:"标题","show-toolbar":"",columns:t.otaScaleList},on:{confirm:t.onConfirm,cancel:function(e){t.show_otaScale=!1}}})],1)],1)},staticRenderFns:[]};var p=a("k6Sl")(f,_,!1,function(t){a("/3GQ")},"data-v-b73d7f16",null);e.default=p.exports}});
//# sourceMappingURL=18.a13434b028b0eed6e6781758781501818.js.map