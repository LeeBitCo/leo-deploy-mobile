webpackJsonp([21,108],{dHlR:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("fdz6"),s=i.n(a),n=i("nNZG"),o=i("RmFe"),r=i.n(o),l=i("s/fh"),c={components:{MyCleaningTask:i("i1uc").default},props:["propsData"],data:function(){return{selected:"0",leaningAll:[],unitAll:[],times:["昨天","本周","本月","自定义"],topTitle:["成本统计","保洁统计","消耗品设置","洗涤品设置"],consumeAll:[],washAll:[],editDataForm:{hotelId:this.$route.query.hotelId,hotelCostType:"2",id:null,costName:null,price:null,unit:null},active:"0",minDate:new Date,maxDate:"",dataTime:null,consumeTotle:0,washTotle:0,time_show:!1,show_editOrRemove:!1,show_addOredit:!1}},computed:{computerWidth:function(){return window.innerWidth/4+"px"}},created:function(){this.cu_time=r()().subtract(1,"year"),this.minDate=new Date(this.cu_time),this.maxDate=new Date(r()())},watch:{selected:function(t,e){this.$store.commit("setHeader",this.topTitle[t]),"0"==t?(this.active="0",this.s_date=r()().subtract(1,"day").format("YYYY-MM-DD"),this.e_date=r()().format("YYYY-MM-DD"),this.dataTime=this.s_date+" - "+this.e_date,this.getTotle()):"2"==t?(this.hotelCostType="2",this.getInfo()):"3"==t&&(this.hotelCostType="3",this.getInfo())}},methods:{getTotle:function(){var t=this,e={hotelId:this.$route.query.hotelId,startTime:this.s_date,endTime:this.e_date};Object(n.d)(e).done(function(e){t.consumeTotle=0,t.washTotle=0,t.consumeAll=[],t.washAll=[],e.data&&(t.consumeAll=e.data,t.consumeAll.map(function(e){t.consumeTotle+=e.price*e.num})),e.order&&(t.washAll=e.order,t.washAll.map(function(e){t.washTotle+=e.price*e.num}))})},getInfo:function(){var t=this,e={hotelId:this.$route.query.hotelId,hotelCostType:this.hotelCostType||"2"};Object(n.a)(e).done(function(e){t.leaningAll=e.data})},chooseTime:function(t){this.active=t,this.e_date=r()().format("YYYY-MM-DD"),"0"==t?(this.s_date=r()().subtract(1,"day").format("YYYY-MM-DD"),this.dataTime=this.s_date+" - "+this.e_date,this.getTotle()):"1"==t?(this.s_date=r()().subtract(7,"day").format("YYYY-MM-DD"),this.dataTime=this.s_date+" - "+this.e_date,this.getTotle()):"2"==t?(this.s_date=r()().subtract(1,"month").format("YYYY-MM-DD"),this.dataTime=this.s_date+" - "+this.e_date,this.getTotle()):this.dataTime=this.s_date+" - "+this.e_date},showTime:function(){this.doble=[],this.time_show=!0},onConfirm:function(t){var e=s()(t,2),i=e[0],a=e[1];this.time_show=!1,this.date=this.formatDate(i)+" - "+this.formatDate(a),this.getTotle()},formatDate:function(t){var e=t.getFullYear()+"-"+(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate());return this.doble.push(e),this.dataTime=this.doble[0]+" - "+this.doble[1],this.s_date=this.doble[0],this.e_date=this.doble[1],(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"/"+(t.getDate()<10?"0"+t.getDate():t.getDate())},editOrRemove:function(t){this.currentInfo=t,this.editDataForm.id=t.id,this.editDataForm.costName=t.costName,this.editDataForm.price=t.price,this.editDataForm.unit=t.unit,this.show_editOrRemove=!0},removeItem:function(){var t=this;this.show_editOrRemove=!1,l.a.confirm({title:this.currentInfo.costName,message:"确定删除?"}).then(function(){Object(n.g)({id:t.currentInfo.id}).done(function(e){t.getInfo()})}).catch(function(){})},confirmEdit:function(t,e){var i=this;if("confirm"==t){if(!this.editDataForm.costName)return Object(l.c)("请输入商品名称"),void e(!1);if(!this.editDataForm.unit)return Object(l.c)("请输入个、瓶、袋、条等单位"),void e(!1);if(!this.editDataForm.price)return Object(l.c)("请输入零售价"),void e(!1);this.editDataForm.id?(this.editDataForm_={id:this.editDataForm.id,costName:this.editDataForm.costName,price:this.editDataForm.price,unit:this.editDataForm.unit},Object(n.f)(this.editDataForm_).done(function(t){e(!1),i.show_addOredit=!1,i.getInfo()})):(this.addDataForm={hotelId:this.$route.query.hotelId,hotelCostType:this.hotelCostType||"2",costName:this.editDataForm.costName,price:this.editDataForm.price,unit:this.editDataForm.unit},Object(n.e)(this.addDataForm).done(function(t){e(!1),i.show_addOredit=!1,i.getInfo()}))}else"cancel"==t&&(e(!1),this.show_addOredit=!1)}}},d={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"invoice-top"}},[i("van-tabs",{attrs:{"title-active-color":"#ff7d41",color:"#ff7d41"},model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}},t._l(t.topTitle,function(t,e){return i("van-tab",{key:e,attrs:{title:t}})}),1),t._v(" "),"0"==t.selected?i("div",[i("div",{staticClass:"date"},[i("div",[t._v("日期范围")]),t._v(" "),t._l(t.times,function(e,a){return i("div",{key:a,staticClass:"b_f1",style:{color:t.active==a?"#048FE5":"#000"},on:{click:function(e){return t.chooseTime(a)}}},[t._v("\n        "+t._s(e)+"\n      ")])})],2),t._v(" "),"3"==t.active?i("div",{staticClass:"time",on:{click:t.showTime}},[i("div",[t._v(t._s(t.dataTime))])]):t._e(),t._v(" "),t.consumeAll.length>0?i("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._l(t.consumeAll,function(e,a){return i("div",{key:a,staticClass:"center_flex f14"},[i("div",{staticClass:"ww_1 c_39"},[t._v(t._s(e.costName))]),t._v(" "),i("div",{staticClass:"ww_2"},[t._v("¥"+t._s(Number(e.price).toFixed(2)))]),t._v(" "),i("div",{staticClass:"ww_3"},[t._v(t._s(e.num))]),t._v(" "),i("div",{staticClass:"ww_4 c_39"},[t._v("¥"+t._s(Number(e.price*e.num).toFixed(2)))])])}),t._v(" "),i("div",{staticClass:"totle_right"},[t._v("合计 ¥"+t._s(Number(t.consumeTotle).toFixed(2)))])],2):t._e(),t._v(" "),t.washAll.length>0?i("div",{staticClass:"content"},[t._m(2),t._v(" "),t._m(3),t._v(" "),t._l(t.washAll,function(e,a){return i("div",{key:a,staticClass:"center_flex f14"},[i("div",{staticClass:"ww_1 c_39"},[t._v(t._s(e.costName))]),t._v(" "),i("div",{staticClass:"ww_2"},[t._v("¥"+t._s(Number(e.price).toFixed(2)))]),t._v(" "),i("div",{staticClass:"ww_3"},[t._v(t._s(e.num))]),t._v(" "),i("div",{staticClass:"ww_4 c_39"},[t._v("¥"+t._s(Number(e.price*e.num).toFixed(2)))])])}),t._v(" "),i("div",{staticClass:"totle_right"},[t._v("合计 ¥"+t._s(Number(t.washTotle).toFixed(2)))])],2):t._e(),t._v(" "),0==t.consumeAll.length&&0==t.washAll.length?i("div",{staticStyle:{margin:"80px 0"}},[t._v("\n      暂无数据\n    ")]):t._e()]):"1"==t.selected?i("div",[i("My-cleaningTask")],1):i("div",[i("div",{staticClass:"add flex",on:{click:function(e){t.show_addOredit=!0,t.editDataForm={}}}},[i("van-icon",{staticStyle:{"padding-right":"8px"},attrs:{name:"add",color:"#FD7E43"}}),t._v("添加"+t._s("2"==t.selected?"消耗品":"洗涤品")+"\n    ")],1),t._v(" "),i("div",{staticClass:"cleaning-box"},t._l(t.leaningAll,function(e,a){return i("div",{key:a,staticClass:"cleaning-center",on:{click:function(i){return t.editOrRemove(e)}}},[i("div",{staticStyle:{"text-align":"left",width:"50%"}},[t._v(t._s(e.costName))]),t._v(" "),i("div",{staticClass:"flex"},[t._v("￥"+t._s(e.price)+"/"+t._s(e.unit)+"\n          "),i("van-icon",{staticStyle:{"padding-left":"8px"},attrs:{name:"arrow",color:"#B9B6BA"}})],1)])}),0)]),t._v(" "),i("van-calendar",{attrs:{type:"range","min-date":t.minDate,"max-date":t.maxDate},on:{confirm:t.onConfirm},model:{value:t.time_show,callback:function(e){t.time_show=e},expression:"time_show"}}),t._v(" "),i("van-popup",{attrs:{position:"bottom","close-on-click-overlay":!1},model:{value:t.show_editOrRemove,callback:function(e){t.show_editOrRemove=e},expression:"show_editOrRemove"}},[i("div",{staticClass:"p10 c_e4",on:{click:t.removeItem}},[t._v("删除")]),t._v(" "),i("div",{staticClass:"p10",on:{click:function(e){t.show_editOrRemove=!1,t.show_addOredit=!0}}},[t._v("编辑")]),t._v(" "),i("div",{staticStyle:{height:"6px",background:"#f5f5f5"},on:{click:function(e){t.show_editOrRemove=!1}}}),t._v(" "),i("div",{staticClass:"p10 c_88",on:{click:function(e){t.show_editOrRemove=!1}}},[t._v("取消")])]),t._v(" "),i("van-dialog",{attrs:{"before-close":t.confirmEdit,title:t.editDataForm.id?"编辑项目":"添加项目",confirmButtonText:"确定",confirmButtonColor:"#fd7e43",cancelButtonColor:"#7A7A7A","show-cancel-button":""},model:{value:t.show_addOredit,callback:function(e){t.show_addOredit=e},expression:"show_addOredit"}},[i("van-field",{attrs:{label:"名称",placeholder:"请输入商品名称"},model:{value:t.editDataForm.costName,callback:function(e){t.$set(t.editDataForm,"costName",e)},expression:"editDataForm.costName"}}),t._v(" "),i("van-field",{attrs:{label:"单位",placeholder:"请输入个、瓶、袋、条等单位"},model:{value:t.editDataForm.unit,callback:function(e){t.$set(t.editDataForm,"unit",e)},expression:"editDataForm.unit"}}),t._v(" "),i("van-field",{attrs:{label:"价格",type:"number",placeholder:"请输入零售价"},model:{value:t.editDataForm.price,callback:function(e){t.$set(t.editDataForm,"price",e)},expression:"editDataForm.price"}})],1)],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"f_w flex"},[e("div",{staticClass:"l_c"}),this._v(" "),e("div",[this._v("消耗品")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"center_flex center"},[e("div",{staticClass:"ww_1"},[this._v("品类")]),this._v(" "),e("div",{staticClass:"ww_2"},[this._v("单价")]),this._v(" "),e("div",{staticClass:"ww_3"},[this._v("消耗数量")]),this._v(" "),e("div",{staticClass:"ww_4"},[this._v("小计")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"f_w flex"},[e("div",{staticClass:"l_c b_c"}),this._v(" "),e("div",[this._v("布草洗涤")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"center_flex center"},[e("div",{staticClass:"ww_1"},[this._v("品类")]),this._v(" "),e("div",{staticClass:"ww_2"},[this._v("单价")]),this._v(" "),e("div",{staticClass:"ww_3"},[this._v("消耗数量")]),this._v(" "),e("div",{staticClass:"ww_4"},[this._v("小计")])])}]};var m=i("k6Sl")(c,d,!1,function(t){i("v29B")},"data-v-af177a50",null);e.default=m.exports},i1uc:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("RmFe"),s=i.n(a),n=i("s/fh"),o=i("1Wd6"),r={data:function(){return{time_show:!1,price_show:!1,times:null,cYearM:"",currentDate:new Date,maxDate:new Date,listLoading:!1,finishedList:!1,pullLoading:!1,listData:[],comment_nums:"",totleNum:null,dataForm:{pageNum:0,pageSize:1e4,hotelId:this.$route.query.hotelId,userId:this.$route.query.userId,status:"2",endTime:""},editDataForm:{cleanAmount:null,remark:null,cleanOrderId:null,cleaningOrderId:null},allDataForm:{hotelId:this.$route.query.hotelId,endTime:""},refData:null,cleanOrderType:null,selected:"1",key:0,contentKey:0,priceAll:0}},filters:{filterAmount:function(t){return t?"￥"+t.toFixed(2):"￥0"}},created:function(){this.refData=this.userId||"",this.$store.commit("setHeader","保洁统计");var t=s()().valueOf(),e=s()(t).year(),i=s()(t).month()+1<10?"0"+(s()(t).month()+1):s()(t).month()+1;this.cYearM=e+"年"+i+"月",this.dataForm.endTime=e+"-"+i,this.getCurrentInfo()},methods:{getCurrentInfo:function(){var t=this,e=null;1==this.selected?(e=o.e,this.dataForm.pageNum=0):2==this.selected?(e=o.c,this.dataForm.pageNum=0):(this.allDataForm.endTime=this.dataForm.endTime,e=o.d),e(e==o.d?this.allDataForm:this.dataForm).done(function(e){t.listData=[],t.priceAll=0,t.totleNum=0,e.data.length>0&&(t.priceAll=e.data.reduce(function(t,e){return t+(e.cleanAmount||0)},0),t.totleNum=e.data.length,t.dealArr(e.data))}),this.dataForm.pageNum++},dealArr:function(t){if(0!=t.length){var e={};t.map(function(t){t.myendTime=s()(t.endTime).format("YYYY-MM-DD"),e[t.myendTime]?e[t.myendTime].push(t):e[t.myendTime]=[t]});var i=[];for(var a in e){var n={};n.time=a,n.child=e[a],n.status=!1,n.totlePrice=e[a].reduce(function(t,e){return t+(e.cleanAmount||0)},0),i.push(n)}++this.contentKey,i.find(function(t,e){return 0==e}).status=!0,this.listData=i}},dealTime:function(t){var e=s()(t).year(),i=s()(t).month()+1<10?"0"+(s()(t).month()+1):s()(t).month()+1;this.cYearM=e+"年"+i+"月",this.dataForm.endTime=e+"-"+i,this.getCurrentInfo()},confirmTime:function(t){this.dealTime(s()(t).valueOf()),this.time_show=!1},editPrice:function(t){this.editDataForm.cleanAmount=t.cleanAmount||0,this.editDataForm.cleanOrderId=t.id,this.editDataForm.remark=t.description,this.cleanOrderType=t.cleanOrderType,this.price_show=!0},confirmDepart:function(t,e){var i=this;if("confirm"==t){if(e(!1),!this.editDataForm.cleanAmount)return void Object(n.c)("请输入保洁金额");var a=null;"0"==this.selected?"1"==this.cleanOrderType?(a=o.m,delete this.editDataForm.cleanOrderId):(a=o.n,delete this.editDataForm.cleaningOrderId):"1"==this.selected?(a=o.n,delete this.editDataForm.cleaningOrderId):"2"==this.selected&&(a=o.m,delete this.editDataForm.cleanOrderId),a(this.editDataForm).done(function(t){Object(n.c)(t.msg),i.getCurrentInfo()}),this.price_show=!1}else"cancel"==t&&(e(!1),this.price_show=!1)}}},l={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{style:{top:t.$route.query.userId?"50px":"103px"},attrs:{id:"cleaningTaskTop"}},[i("div",[i("div",{staticClass:"task-top"},[i("div",{staticClass:"top-left",on:{click:function(e){t.time_show=!0}}},[i("span",[t._v(t._s(t.cYearM))]),t._v(" "),i("van-icon",{attrs:{name:"arrow-down"}})],1),t._v(" "),i("div",[i("mt-navbar",{nativeOn:{click:function(e){return t.getCurrentInfo()}},model:{value:t.selected,callback:function(e){t.selected=e},expression:"selected"}},[t.$route.query.userId?t._e():i("mt-tab-item",{attrs:{id:"0"}},[i("span",[t._v("全部")])]),t._v(" "),i("mt-tab-item",{attrs:{id:"1"}},[i("span",[t._v("退房打扫")])]),t._v(" "),i("mt-tab-item",{attrs:{id:"2"}},[i("span",[t._v("续住打扫")])])],1)],1)]),t._v(" "),i("div",{staticClass:"totleAll"},[i("div",[t._v("\n        共完成"),i("span",{staticClass:"c_00 f18"},[t._v(t._s(t.totleNum))]),t._v("单"+t._s("清洁")+"任务，合计收入\n      ")]),t._v(" "),i("div",{staticClass:"c_00 f20"},[t._v(t._s(t._f("filterAmount")(t.priceAll||0)))])]),t._v(" "),i("div",{key:t.contentKey,staticClass:"task-list"},[i("div",t._l(t.listData,function(e,a){return i("div",{key:a},[i("div",{staticClass:"task",on:{click:function(t){e.status=!e.status}}},[i("div",{staticClass:"task-left"},[i("div",{staticClass:"g_fw",staticStyle:{"font-size":"15px"}},[t._v(t._s(t._f("dataFilter")(e.time,"MM月DD日")))]),t._v(" "),i("div",{staticClass:"f12"},[t._v(t._s("共完成"+e.child.length+"单"))])]),t._v(" "),i("div",{staticClass:"task-right task-right-top"},[i("div",[t._v(t._s(t._f("filterAmount")(e.totlePrice)))]),t._v(" "),i("van-icon",{staticStyle:{"margin-left":"5px"},attrs:{name:0==e.status?"arrow":"arrow-down"}})],1)]),t._v(" "),e.status?i("div",{key:t.key},t._l(e.child,function(e,a){return i("div",{key:a,staticClass:"task"},[i("div",{staticClass:"task-left"},[i("div",[t._v(t._s(e.roomScale.scaleName)+" "+t._s(e.roomSn)+" "),t.$route.query.userId||"0"!=t.selected?t._e():i("span",{class:1==e.cleanOrderType?"go":"back",staticStyle:{"font-size":"12px"}},[t._v(t._s(1==e.cleanOrderType?"续住":"退房"))])]),t._v(" "),i("div",{staticClass:"f12"},[t._v(t._s(e.endTime.substr(11))+" "),!t.$route.query.userId&&e.sysUser?i("span",[t._v(t._s(e.sysUser.realName))]):t._e()])]),t._v(" "),i("div",{staticClass:"task-right",on:{click:function(i){return t.editPrice(e)}}},[i("div",[i("div",[t._v(t._s(t._f("filterAmount")(e.cleanAmount)))]),t._v(" "),e.description?i("div",{staticClass:"f12"},[t._v("备注："+t._s(e.description))]):t._e()]),t._v(" "),i("van-icon",{staticStyle:{"margin-left":"5px"},attrs:{name:"arrow"}})],1)])}),0):t._e()])}),0)])]),t._v(" "),i("van-popup",{attrs:{position:"bottom"},model:{value:t.time_show,callback:function(e){t.time_show=e},expression:"time_show"}},[i("van-datetime-picker",{staticClass:"timeBox",attrs:{type:"year-month","max-date":t.maxDate},on:{cancel:function(e){t.time_show=!1},confirm:t.confirmTime},model:{value:t.currentDate,callback:function(e){t.currentDate=e},expression:"currentDate"}})],1),t._v(" "),i("van-dialog",{attrs:{title:"0"==t.selected?0==t.cleanOrderType?"清洁金额":"保洁金额":"1"==t.selected?"清洁金额":"保洁金额","show-cancel-button":"","before-close":t.confirmDepart},model:{value:t.price_show,callback:function(e){t.price_show=e},expression:"price_show"}},[i("van-cell-group",[i("van-field",{attrs:{label:"0"==t.selected?0==t.cleanOrderType?"清洁金额":"保洁金额":"1"==t.selected?"清洁金额":"保洁金额",placeholder:"0"==t.selected?0==t.cleanOrderType?"请输入清洁金额":"请输入保洁金额":"1"==t.selected?"清洁金额":"保洁金额"},model:{value:t.editDataForm.cleanAmount,callback:function(e){t.$set(t.editDataForm,"cleanAmount",e)},expression:"editDataForm.cleanAmount"}}),t._v(" "),i("van-field",{attrs:{label:"备注",placeholder:"请输入备注"},model:{value:t.editDataForm.remark,callback:function(e){t.$set(t.editDataForm,"remark",e)},expression:"editDataForm.remark"}})],1)],1)],1)},staticRenderFns:[]};var c=i("k6Sl")(r,l,!1,function(t){i("ibEJ")},"data-v-4545b99e",null);e.default=c.exports},ibEJ:function(t,e){},v29B:function(t,e){}});
//# sourceMappingURL=21.9b9dddc8166f7dc0f2fe1758782009845.js.map