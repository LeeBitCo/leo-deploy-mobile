webpackJsonp([145],{AEpj:function(e,t){},iqhd:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i("s/fh"),r=i("NpYV"),s=i("UJbh"),a=i("Gwi0"),d=i("tN5p"),c={data:function(){return{lifeCosts:[],editPrice:{},obj:{1:"电",2:"水",3:"气"},unit:{1:"元/度",2:"元/吨",3:"元/m³"},unit1:{1:"度",2:"吨",3:"m³"},addShow:!1,addPrice:"",addObjShow:!1,show_lifeCostPay:!1,columns:[],payAll:[],title:"",dictSort:"",objItem:"",detailPrice:"",preDegree:null,Degree:null,lifeCost_mode:null,add_or_edeit:null}},created:function(){this.$store.commit("setHeader","编辑账单"),this.$route.query.cooperLifeCostBillId?this.getCurrentCooperInfo(this.$route.query.cooperLifeCostBillId):this.getCurrentInfo(this.$route.query.lifeCostBillId)},filters:{filterPrice:function(e){return Number(e).toFixed(2)}},methods:{getCurrentInfo:function(e){var t=this;Object(a.w)(e).done(function(e){t.currentInfo=e.data,t.getMore()})},getCurrentCooperInfo:function(e){var t=this;Object(d.a)({cooperLifeCostBillId:e}).done(function(e){t.currentInfo=e.data,t.getMore()})},getMore:function(){var e=this;Object(s.a)({dictType:"tb_business_life_cost_mode"}).done(function(t){e.payOldAll=t.data,e.payAll=t.data.map(function(e){return e.dictLabel}),e.lifeCost_mode=e.payOldAll[0].dictLabel}),Object(s.a)({dictType:"business_life_cost"}).done(function(t){var i=t.data.map(function(t){switch(t.dictValue){case"elecPrice":t.Price=e.currentInfo.elecPrice||0,t.Degree=e.currentInfo.elecDegree||e.currentInfo.preElecDegree||0,t.preDegree=e.currentInfo.preElecDegree||0,t.elecMode=e.currentInfo.elecMode;break;case"waterPrice":t.Price=e.currentInfo.waterPrice||0,t.Degree=e.currentInfo.waterDegree||e.currentInfo.preWaterDegree||0,t.preDegree=e.currentInfo.preWaterDegree||0,t.waterMode=e.currentInfo.waterMode;break;case"gasPrice":t.Price=e.currentInfo.gasPrice||0,t.Degree=e.currentInfo.gasDegree||e.currentInfo.preGasDegree||0,t.preDegree=e.currentInfo.preGasDegree||0,t.gasMode=e.currentInfo.gasMode;break;case"propPrice":t.Price=e.currentInfo.propPrice;break;case"rubbishPrice":t.Price=e.currentInfo.rubbishPrice;break;case"parkPrice":t.Price=e.currentInfo.parkPrice;break;case"broadBandPrice":t.Price=e.currentInfo.broadBandPrice;break;default:t.showlength=-1}return t});e.oldLifeCosts=i,e.lifeCosts=i.filter(function(e){return e.Price>0})})},clearNoNum:function(e,t){(e=(e=(e=(e=(e=e.toString()).replace(/[^\d.]/g,"")).replace(/\.{2,}/g,".")).replace(".","$#$").replace(/\./g,"").replace("$#$",".")).replace(/^(\-)*(\d+)\.(\d\d).*$/,"$1$2.$3")).indexOf(".")<0&&""!=e&&(e=parseFloat(e)),"price"==t?this.addPrice=e:"lastNum"==t?this.preDegree=e:"nowNum"==t&&(this.Degree=e)},addRight:function(e){var t=this;this.add_or_edeit=e;var i=[];this.oldLifeCosts.forEach(function(e){t.lifeCosts.map(function(e){return e.dictLabel}).includes(e.dictLabel)||i.push(e)}),this.columns=i,this.columns.length>0?(this.addShow=!0,this.title=this.columns[0].dictLabel,this.dictSort=this.columns[0].dictSort,this.gasMode=this.columns[0].gasMode,this.objItem="",this.addPrice="",this.preDegree="",this.Degree=""):Object(o.c)({message:"暂无可添加费用项目",duration:900})},onConfirm:function(e){this.title=e.dictLabel,this.dictSort=e.dictSort,this.addObjShow=!1},onConfirmCostPayType:function(e){this.lifeCost_mode=e;var t=this.payOldAll.find(function(t){return t.dictLabel==e}).dictValue;1==this.dictSort?this.elecMode=t:2==this.dictSort?this.waterMode=t:3==this.dictSort&&(this.gasMode=t),this.show_lifeCostPay=!1},addSure:function(){var e=this;if(this.addPrice){if(this.dictSort<4){if(!this.Degree&&"抄表计算"==this.lifeCost_mode&&"add"==this.add_or_edeit)return void Object(o.c)({message:"请输入本次读数",duration:900});if(+this.Degree<+this.preDegree)return Object(o.c)({message:"上次读数应小于等于本次读数",duration:900}),void(this.Degree="")}this.objItem?(this.oldLifeCosts.find(function(t){return t.dictSort==e.objItem.dictSort}).Price=this.addPrice,this.oldLifeCosts.find(function(t){return t.dictSort==e.objItem.dictSort}).Degree=this.Degree,this.oldLifeCosts.find(function(t){return t.dictSort==e.objItem.dictSort}).preDegree=this.preDegree,this.lifeCosts=this.oldLifeCosts.filter(function(e){return e.Price>0}),this.addShow=!1):this.addSave()}else Object(o.c)({message:"请输入单价",duration:900})},addSave:function(){var e=this,t={checkType:this.dictSort,price:Number(this.addPrice).toFixed(2)};this.dictSort<4&&(t.preDegree=Number(this.preDegree).toFixed(2),t.degree=Number(this.Degree).toFixed(2)),1==this.dictSort?(t.mode=this.elecMode,"2"==this.elecMode&&(delete t.degree,delete t.preDegree)):2==this.dictSort?(t.mode=this.waterMode,"2"==this.waterMode&&(delete t.degree,delete t.preDegree)):3==this.dictSort&&(t.mode=this.gasMode,"2"==this.gasMode&&(delete t.degree,delete t.preDegree)),this.$route.query.cooperLifeCostBillId?(t.cooperLifeCostBillId=this.$route.query.cooperLifeCostBillId,Object(d.y)(t).done(function(t){e.getCurrentCooperInfo(e.$route.query.cooperLifeCostBillId)}),this.addShow=!1):(t.lifeCostBillId=this.$route.query.lifeCostBillId,Object(a._35)(this.$route.query.lifeCostBillId,t).done(function(t){e.getCurrentInfo(e.$route.query.lifeCostBillId)}),this.addShow=!1)},remove:function(e){var t=this;r.MessageBox.confirm("",{message:"确认删除"+e.dictLabel+"？",title:"提示",cancelButtonText:"取消",confirmButtonText:"确定"}).then(function(i){if("confirm"==i){var r={checkType:e.dictSort};t.$route.query.cooperLifeCostBillId?(r.cooperLifeCostBillId=t.$route.query.cooperLifeCostBillId,Object(d.z)(r).done(function(e){t.getCurrentCooperInfo(t.$route.query.cooperLifeCostBillId)})):Object(a._36)(t.$route.query.lifeCostBillId,r).done(function(e){Object(o.c)({message:e.msg,duration:900}),t.getCurrentInfo(t.$route.query.lifeCostBillId)})}}).catch(function(e){console.log(e)})},setItem:function(e,t){var i=this;this.add_or_edeit=t,e.dictSort<4&&(this.addShow=!0,this.objItem=e,this.addPrice=this.objItem.Price,this.preDegree=this.objItem.preDegree,this.Degree=this.objItem.Degree,this.dictSort=this.objItem.dictSort,1==this.objItem.dictSort?this.lifeCost_mode=this.payOldAll.find(function(e){return e.dictValue==i.objItem.elecMode}).dictLabel:2==this.objItem.dictSort?this.lifeCost_mode=this.payOldAll.find(function(e){return e.dictValue==i.objItem.waterMode}).dictLabel:3==this.objItem.dictSort&&(this.lifeCost_mode=this.payOldAll.find(function(e){return e.dictValue==i.objItem.gasMode}).dictLabel),this.detailPrice=(this.Degree-this.preDegree)*this.addPrice)},saveBack:function(){var e=this,t={};t.id=this.$route.query.cooperLifeCostBillId,this.lifeCosts.map(function(i){i.dictSort<4&&(1==i.dictSort&&"1"==i.elecMode?(t.elecDegree=e.lifeCosts.find(function(e){return 1==e.dictSort}).Degree,t.elecMode=i.elecMode):2==i.dictSort&&"1"==i.waterMode?(t.waterDegree=e.lifeCosts.find(function(e){return 2==e.dictSort}).Degree,t.waterMode=i.waterMode):3==i.dictSort&&"1"==i.gasMode&&(t.gasDegree=e.lifeCosts.find(function(e){return 3==e.dictSort}).Degree,t.gasMode=i.gasMode)),t[i.dictValue]=i.Price}),r.MessageBox.confirm("",{message:"确认提交账单？",title:"提示",cancelButtonText:"取消",confirmButtonText:"确定"}).then(function(i){"confirm"==i&&(e.$route.query.cooperLifeCostBillId?Object(d.A)(t).done(function(e){Object(o.c)({message:e.msg,duration:900}),setTimeout("window.history.go(-1)",900),localStorage.removeItem("life_fee")}):(t.id=e.$route.query.lifeCostBillId,Object(a._38)(t).done(function(e){Object(o.c)({message:e.msg,duration:900}),setTimeout("window.history.go(-1)",900),localStorage.removeItem("life_fee")})))}).catch(function(e){console.log(e)})}}},n={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"editBox"},[o("div",{staticClass:"local_info"},[o("span",[e._v("费用项目")]),e._v(" "),o("img",{staticClass:"img_add_delete",attrs:{src:i("6m+W"),alt:""},on:{click:function(t){return e.addRight("add")}}})]),e._v(" "),o("div",e._l(e.lifeCosts,function(t){return o("table",{key:t.id,staticClass:"info_box",style:{padding:t.dictSort<4?"4px 20px":"14px 20px"}},[o("tr",[o("td",[o("img",{staticClass:"img_add_delete",attrs:{src:i("/hLb"),alt:""},on:{click:function(i){return e.remove(t)}}}),e._v(" "),o("div",{staticClass:"price_unit"},[o("div",[o("span",{staticClass:"three",class:t.dictSort<4?"w000":"",style:{"padding-bottom":t.dictSort<4?"0.2rem":"0"}},[e._v(e._s(t.dictLabel))]),e._v(" "),"1"==t.dictSort&&"1"==t.elecMode||"2"==t.dictSort&&"1"==t.waterMode||"3"==t.dictSort&&"1"==t.gasMode?o("span",[e._v(e._s(t.Price)+e._s(e.unit[t.dictSort]))]):e._e()]),e._v(" "),"1"==t.dictSort&&"1"==t.elecMode||"2"==t.dictSort&&"1"==t.waterMode||"3"==t.dictSort&&"1"==t.gasMode?o("div",[t.Degree>0?o("span",[e._v("本期用"+e._s(e.obj[t.dictSort])+":")]):e._e(),e._v(" "),t.Degree>0?o("span",[e._v("\n                "+e._s((t.Degree-t.preDegree).toFixed(2))+e._s(e.unit1[t.dictSort])+" ("+e._s(t.preDegree)+"-"+e._s(t.Degree)+")\n              ")]):e._e()]):o("div")])]),e._v(" "),"1"==t.dictSort&&"1"==t.elecMode||"2"==t.dictSort&&"1"==t.waterMode||"3"==t.dictSort&&"1"==t.gasMode?o("td",{staticClass:"f14",on:{click:function(i){return e.setItem(t,"edit")}}},[(t.Degree-t.preDegree)*t.Price<0?o("span",{staticClass:"c000"},[e._v("0")]):o("span",{staticClass:"c000"},[e._v(e._s(((t.Degree-t.preDegree)*t.Price).toFixed(2))),o("span",{staticStyle:{color:"#888",padding:"0 2px"}},[e._v("元")])]),e._v(" "),o("van-icon",{staticClass:"cb2",attrs:{name:"arrow"}})],1):o("td",{staticClass:"f14",on:{click:function(i){return e.setItem(t,"edit")}}},[o("span",[o("span",{staticClass:"c000"},[e._v(e._s(t.elecMode||t.waterMode||"2"==t.gasMode?t.Price.toFixed(2):t.Price))]),e._v(" "),"1"==t.dictSort?o("span",[e._v(e._s("3"==t.elecMode?e.unit1[t.dictSort]:"元"))]):"2"==t.dictSort?o("span",[e._v(e._s("3"==t.waterMode?e.unit1[t.dictSort]:"元"))]):"3"==t.dictSort?o("span",[e._v(e._s("3"==t.gasMode?e.unit1[t.dictSort]:"元"))]):o("span",[e._v("元")]),e._v(" "),t.dictSort<"4"?o("van-icon",{staticClass:"cb2",attrs:{name:"arrow"}}):e._e()],1)])])])}),0),e._v(" "),o("van-button",{staticClass:"saveStyle",attrs:{type:"primary"},on:{click:e.saveBack}},[e._v("保存")]),e._v(" "),o("van-popup",{staticClass:"addBox",model:{value:e.addShow,callback:function(t){e.addShow=t},expression:"addShow"}},[o("div",[e.objItem?o("p",{staticClass:"add-title"},[e._v(e._s(e.obj[e.objItem.dictSort])+"费详情")]):o("p",{staticClass:"add-title"},[e._v("添加费用")]),e._v(" "),e.objItem?e._e():o("div",{staticClass:"add-obj"},[o("div",[e._v("费用项目")]),e._v(" "),o("div",{on:{click:function(t){e.addObjShow=!0}}},[o("span",[e._v(e._s(e.title))]),e._v(" "),o("van-icon",{staticClass:"cb2",attrs:{name:"arrow"}})],1)]),e._v(" "),o("div",{staticClass:"add-obj"},[o("div",[e._v("收费方式")]),e._v(" "),e.dictSort<4?o("div",{on:{click:function(t){"add"==e.add_or_edeit&&(e.show_lifeCostPay=!0)}}},[o("span",[e._v(e._s(e.lifeCost_mode))]),e._v(" "),"add"==e.add_or_edeit?o("van-icon",{staticClass:"cb2",attrs:{name:"arrow"}}):e._e()],1):o("div",[e._v("固定收取")])]),e._v(" "),o("div",{staticClass:"add-obj"},[o("span",{staticClass:"w30"},[e._v("单价")]),e._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:e.addPrice,expression:"addPrice"}],staticClass:"addInput60",attrs:{type:"text",placeholder:"请输入单价"},domProps:{value:e.addPrice},on:{keyup:function(t){return e.clearNoNum(e.addPrice,e.name="price")},input:function(t){t.target.composing||(e.addPrice=t.target.value)}}}),e._v(" "),e.objItem&&"2"==e.objItem.dictSort?o("div",{staticClass:"w10"},[e._v("元/月")]):e.objItem&&"2"!=e.objItem.dictSort?o("div",{staticClass:"w10"},[e._v(e._s("抄表计算"==e.lifeCost_mode?e.unit[e.objItem.dictSort]:e.unit1[e.objItem.dictSort]))]):e._e(),e._v(" "),e.objItem||"固定收取"!=e.lifeCost_mode?e.objItem||"固定收取"==e.lifeCost_mode?e._e():o("div",{staticClass:"w10"},[e._v(e._s("抄表计算"==e.lifeCost_mode?e.unit[e.dictSort]:e.unit1[e.dictSort]))]):o("div",{staticClass:"w10"},[e._v("元/月")])]),e._v(" "),e.dictSort<4&&"抄表计算"==e.lifeCost_mode?o("div",{staticClass:"add-obj"},[o("span",{staticClass:"w30"},[e._v("上次读数")]),e._v(" "),e.objItem?o("input",{directives:[{name:"model",rawName:"v-model",value:e.preDegree,expression:"preDegree"}],staticClass:"addInput60 cb2",attrs:{readonly:"",type:"text",placeholder:"请输入上次读数"},domProps:{value:e.preDegree},on:{input:function(t){t.target.composing||(e.preDegree=t.target.value)}}}):o("input",{directives:[{name:"model",rawName:"v-model",value:e.preDegree,expression:"preDegree"}],staticClass:"addInput60",attrs:{type:"text",placeholder:"请输入上次读数"},domProps:{value:e.preDegree},on:{keyup:function(t){return e.clearNoNum(e.preDegree,e.name="lastNum")},input:function(t){t.target.composing||(e.preDegree=t.target.value)}}}),e._v(" "),o("div",{staticClass:"w10"})]):e._e(),e._v(" "),e.dictSort<4&&"抄表计算"==e.lifeCost_mode?o("div",{staticClass:"add-obj"},[o("span",{staticClass:"w30"},[e._v("本次读数")]),e._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:e.Degree,expression:"Degree"}],staticClass:"addInput60",attrs:{type:"text",placeholder:"请输入本次读数"},domProps:{value:e.Degree},on:{keyup:function(t){return e.clearNoNum(e.Degree,e.name="nowNum")},input:function(t){t.target.composing||(e.Degree=t.target.value)}}}),e._v(" "),o("div",{staticClass:"w10"})]):e._e(),e._v(" "),e.objItem&&"抄表计算"==e.lifeCost_mode?o("div",{staticClass:"add-obj"},[o("span",{staticClass:"w30"},[e._v("应收费用")]),e._v(" "),o("span",{staticClass:"addInput60 c60"},[e._v(e._s(e._f("filterPrice")((e.Degree-e.preDegree)*e.addPrice))+" "),o("span",{staticClass:"w10"},[e._v("元")])]),e._v(" "),o("div",{staticClass:"w10"})]):e._e(),e._v(" "),o("div",{staticClass:"add-button"},[o("div",{staticClass:"add-cancle",on:{click:function(t){e.addShow=!1}}},[e._v("取消")]),e._v(" "),o("div",{staticClass:"add-sure",on:{click:e.addSure}},[e._v("确定")])])])]),e._v(" "),o("van-popup",{attrs:{round:"",position:"bottom"},model:{value:e.addObjShow,callback:function(t){e.addObjShow=t},expression:"addObjShow"}},[o("van-picker",{attrs:{"show-toolbar":"",columns:e.columns,"value-key":"dictLabel"},on:{cancel:function(t){e.addObjShow=!1},confirm:e.onConfirm}})],1),e._v(" "),o("van-popup",{attrs:{position:"bottom"},model:{value:e.show_lifeCostPay,callback:function(t){e.show_lifeCostPay=t},expression:"show_lifeCostPay"}},[o("van-picker",{attrs:{"show-toolbar":"",columns:e.payAll},on:{confirm:e.onConfirmCostPayType,cancel:function(t){e.show_lifeCostPay=!1}}})],1)],1)},staticRenderFns:[]};var l=i("k6Sl")(c,n,!1,function(e){i("AEpj")},"data-v-0f6b5df6",null);t.default=l.exports}});
//# sourceMappingURL=145.4aa32f1da1c00ce6103f1758782009845.js.map