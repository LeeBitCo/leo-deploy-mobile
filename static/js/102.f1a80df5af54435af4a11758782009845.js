webpackJsonp([102],{P5df:function(t,o){},kn2Z:function(t,o,e){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var i=e("NpYV"),a=e("UJbh"),s=e("Gwi0"),n={data:function(){return{name:"日租房",tableDate:{},clientWidth:"",infoAll:[],chooseList:[],week:["日","一","二","三","四","五","六"],getDates:[],tdsWidth:0,itemValue:{},leftObj:{},edit_show:!1,choosedName:"",value:"0",options:[{label:"无限量",value:"0"},{label:"限量",value:"1"}],statu:"0",states:[{label:"开房",value:"0"},{label:"关房",value:"1"}],day:"",allCount:"",currentNum:"0",reNum_show:!0,addNum_show:!0,innerHeight:"",pageNum:1,pageSize:10,scrollLeft:0}},computed:{setStyle_1:function(t){return function(t){return"五"==t||"六"==t?'<span style="color:#60;font-size:10px;color:#fb9e58;">周'+t+"</span>":'<span style="color:#60;font-size:10px;">周'+t+"</span>"}}},created:function(){this.$store.commit("setHeader","房态管理"),this.getmore(),this.innerHeight=window.innerHeight-50},mounted:function(){var t=this;window.addEventListener("scroll",function(){var o=document.getElementById("my-table").scrollLeft,e=document.getElementById("my-table").clientWidth,i=document.getElementById("my-table").scrollWidth;parseInt(i-o)==e&&(t.pageNum++,t.getState())},!0)},methods:{getmore:function(){var t=this;Object(a.a)({dictType:"business_virtual_room_scale_type"}).done(function(o){t.chooseList=o.data}),this.getState()},choose:function(t){for(var o=0;o<this.chooseList.length;o++)t.target.value==this.chooseList[o].dictLabel&&(this.scaleType=this.chooseList[o].dictValue,this.pageNum=1,this.tableDate={},this.getDates=[]);this.getState()},getState:function(){var t=this,o={scaleType:void 0==this.scaleType?1:this.scaleType,pageNum:this.pageNum,pageSize:this.pageSize};Object(s._15)(this.$route.query.hotelId,o).done(function(o){if(o.data){t.infoAll.concat(o.data),t.infoAll=o.data;var e=t.tableDate;t.leftObj={};for(var i=0;i<t.infoAll.length;i++)t.leftObj[t.infoAll[i].roomScaleId]=t.infoAll[i].roomScale.scaleName;t.infoAll.forEach(function(o,i){if(o.roomStates.forEach(function(o){-1==t.getDates.indexOf(o.day)&&t.getDates.push(o.day)}),e[o.roomScaleId])1==t.pageNum?e[o.roomScaleId].list.push({scaleName:o.scaleName,roomStates:o.roomStates,roomCount:o.roomStates[0].roomCount,roomBook:o.roomStates[0].roomBook,roomScaleId:o.id}):e[o.roomScaleId].list.forEach(function(t){t.scaleName==o.scaleName&&(t.roomStates=t.roomStates.concat(o.roomStates))});else{for(var a=0;a<o.roomStates.length;a++);e[o.roomScaleId]={list:[],value_statu:!0},e[o.roomScaleId].list.push({scaleName:o.scaleName,roomStates:o.roomStates,roomCount:o.roomStates[0].roomCount,roomBook:o.roomStates[0].roomBook,roomScaleId:o.id})}}),t.$nextTick(function(){var t=document.getElementById("head-tds");this.tdsWidth=t.clientWidth||t.offsetWidth})}})},btnChange:function(t){this.value=t,t.value_statu=!t.value_statu},btnGet:function(t,o,e,a,s){this.item_virtualRoomBook=a.virtualRoomBook,this.roomScale=t.list.filter(function(t){return t.scaleName==s});var n=0;if(t.list.forEach(function(t){0==t.roomStates[e].maxSaleCount&&(t.roomStates[e].maxSaleCount=t.roomStates[e].virtualRoomBook=0),n+=t.roomStates[e].maxSaleCount-t.roomStates[e].virtualRoomBook}),this.totleSum=n,this.roomScaleId=this.roomScale[0].roomScaleId,this.day=a.day,this.totleSum<=a.maxSaleCount-a.virtualRoomBook)return Object(i.Toast)({message:"暂不能修改",duration:900}),!1;if(1==t.list.length)return Object(i.Toast)({message:"暂不能修改",duration:900}),!1;if(t.list.length>1){this.index=o,this.index_0=e,this.currentNum=a.maxSaleCount-a.virtualRoomBook>a.roomCount-a.roomBook?a.roomCount-a.roomBook:a.maxSaleCount-a.virtualRoomBook,this.virtualRoomBook=a.roomBook;var l=t.list.filter(function(t){return t.scaleName!=s});if(this.item=a,1==l.length){var r=l[0].roomStates[this.index_0];this.other_child=r.maxSaleCount-r.virtualRoomBook>r.roomCount-r.roomBook?r.roomCount-r.roomBook:r.maxSaleCount-r.virtualRoomBook,this.currentNum+this.other_child>=this.item.roomCount-this.item.roomBook&&(this.max=this.item.roomCount-this.item.roomBook,this.min=this.item.roomCount-this.item.roomBook-this.other_child)}else{this.other_child_0=0,this.other_child_1=0,this.other_child_2=0;for(var m=0;m<l.length;m++){if(0==m){var c=l[m].roomStates[this.index_0];this.other_child_0=c.maxSaleCount-c.virtualRoomBook>c.roomCount-c.roomBook?c.roomCount-c.roomBook:c.maxSaleCount-c.virtualRoomBook}if(1==m){var d=l[m].roomStates[this.index_0];this.other_child_1=d.maxSaleCount-d.virtualRoomBook>d.roomCount-d.roomBook?d.roomCount-d.roomBook:d.maxSaleCount-d.virtualRoomBook}if(2==m){var u=l[m].roomStates[this.index_0];this.other_child_2=u.maxSaleCount-u.virtualRoomBook>u.roomCount-u.roomBook?u.roomCount-u.roomBook:u.maxSaleCount-u.virtualRoomBook}this.currentNum+this.other_child_0+this.other_child_1+this.other_child_2>=this.item.roomCount-this.item.roomBook&&(this.max=this.item.roomCount-this.item.roomBook,this.min=this.item.roomCount-this.item.roomBook-(this.other_child_0+this.other_child_1+this.other_child_2))}}this.min=this.min<0?0:this.min,this.max=this.max}this.edit_show=!0,this.choosedName=s,this.allCount=a.roomCount-a.roomBook},reduce_num:function(){if(this.min==this.currentNum)return document.getElementById("btn_reduce").disabled=!0,Object(i.Toast)({message:"最少设置"+this.min+"间",duration:900}),this.addNum_show=!0,!1;this.currentNum--,this.addNum_show=!0,this.min==this.currentNum&&(document.getElementById("btn_reduce").disabled=!0),this.currentNum<this.max&&(document.getElementById("btn_add").disabled=!1)},add_num:function(){if(this.max==this.currentNum)return document.getElementById("btn_add").disabled=!0,Object(i.Toast)({message:"最多设置"+this.max+"间",duration:900}),this.addNum_show=!0,!1;this.currentNum++,this.currentNum==this.max&&(document.getElementById("btn_add").disabled=!0),this.min<this.currentNum&&(document.getElementById("btn_reduce").disabled=!1)},btn_cancel:function(){this.statu="0",this.value="0",this.edit_show=!1},btn_ok:function(){var t=this,o="";if(1==this.statu){if(0!=this.min)return Object(i.Toast)({message:"至少设置"+this.min+"间",duration:900}),!1;o={roomScaleId:this.roomScaleId,maxSaleRoom:0,stateDate:this.day}}else o={roomScaleId:this.roomScaleId,maxSaleRoom:0==this.value?"-1":Number(this.currentNum)+Number(this.item_virtualRoomBook),stateDate:this.day};Object(s._83)(o).done(function(o){location.reload(),t.getState()}),this.statu="0",this.value="0",this.edit_show=!1}}},l={render:function(){var t=this,o=t.$createElement,i=t._self._c||o;return i("div",{staticClass:"my-table",style:{height:t.innerHeight+"px"},attrs:{id:"my-table"}},[i("div",{staticClass:"table",style:{width:t.tdsWidth+"px"}},[i("div",{staticClass:"tr"},[i("div",{staticClass:"head"},[i("div",{staticClass:"th"},[i("select",{staticClass:"type_box",on:{change:function(o){return t.choose(o)}}},t._l(t.chooseList,function(o,e){return i("option",{key:e,domProps:{value:o.dictLabel}},[t._v(t._s(o.dictLabel))])}),0)]),t._v(" "),i("div",{staticClass:"tds",attrs:{id:"head-tds"}},t._l(t.getDates,function(o,e){return i("div",{key:e+"_states",staticClass:"td c_time"},[i("p",[t._v(t._s(o.substr(5,5)))]),t._v(" "),i("p",{domProps:{innerHTML:t._s(t.setStyle_1(t.week[new Date(o.replace(/-/g,"/")).getDay()]))}})])}),0)])]),t._v(" "),t._l(t.tableDate,function(o,a){return i("div",{key:a,staticClass:"tr",staticStyle:{"margin-bottom":"10px","border-top":"1px solid #4B4B4B"}},[i("div",{staticClass:"body",attrs:{id:"myScoll"}},[i("div",{staticClass:"th center_left",on:{click:function(e){return t.btnChange(o)}}},[t.leftObj?i("div",[i("p",[t._v(t._s(t.leftObj[a]))]),t._v(" "),i("p",{staticStyle:{color:"#888"}},[t._v("共"+t._s(o.list[0].roomCount)+"间")])]):t._e(),t._v(" "),i("span",[o.value_statu?i("img",{staticStyle:{display:"inline-block",width:"20px",height:"20px"},attrs:{src:e("M2uH"),alt:""}}):i("img",{staticStyle:{display:"inline-block",width:"20px",height:"20px"},attrs:{src:e("JfLI"),alt:""}})])]),t._v(" "),t._l(o.list[0].roomStates,function(o,e){return i("div",{key:e,staticClass:"td c_scale"},[t._v(t._s(o.roomCount-o.roomBook)+"间")])})],2),t._v(" "),o.value_statu?i("div",{staticClass:"children"},t._l(o.list,function(e,a){return i("div",{key:a,staticClass:"body"},[i("div",{staticClass:"th c_pro"},[t._v(t._s(e.scaleName))]),t._v(" "),t._l(e.roomStates,function(s,n){return i("div",{key:n,staticClass:"tds"},[i("div",{staticClass:"td line_td",on:{click:function(i){return t.btnGet(o,a,n,s,e.scaleName)}}},[0==s.maxSaleCount?i("div",{staticStyle:{color:"#fb9e58"}},[t._v("满房")]):i("div",[(s.maxSaleCount-s.virtualRoomBook>s.roomCount-s.roomBook?s.roomCount-s.roomBook:s.maxSaleCount-s.virtualRoomBook!=0)?i("span",[t._v("\n                  "+t._s(s.maxSaleCount-s.virtualRoomBook>s.roomCount-s.roomBook?s.roomCount-s.roomBook:s.maxSaleCount-s.virtualRoomBook)+"间\n                ")]):i("span",{staticStyle:{color:"#fb9e58"}},[t._v("满房")])])])])})],2)}),0):t._e()])})],2),t._v(" "),i("mt-popup",{staticStyle:{width:"90%","border-radius":"10px"},attrs:{position:"center"},model:{value:t.edit_show,callback:function(o){t.edit_show=o},expression:"edit_show"}},[i("div",{staticStyle:{"padding-left":"20px","text-align":"left","line-height":"30px"}},[i("p",{staticStyle:{"font-weight":"bold","font-size":"16px","margin-top":"5px"}},[t._v("修改房量")]),t._v(" "),i("div",{staticStyle:{"-color":"#888","-display":"flex","align-items":"center"}},[i("p",[t._v("\n          "+t._s(t.choosedName)+" "+t._s(t.day)+"\n          "),i("br")])])]),t._v(" "),i("div",{staticStyle:{display:"flex","align-items":"center","text-align":"left","padding-left":"20px","white-space":"nowrap"}},[i("p",[t._v("房态设置")]),t._v(" "),i("p",{staticStyle:{width:"78%"}},[i("mt-radio",{staticStyle:{display:"flex",border:"none"},attrs:{options:t.states},model:{value:t.statu,callback:function(o){t.statu=o},expression:"statu"}})],1)]),t._v(" "),0==t.statu?i("div",{staticStyle:{display:"flex","align-items":"center","text-align":"left","padding-left":"20px","white-space":"nowrap"}},[i("p",[t._v("房量设置")]),t._v(" "),i("p",{staticStyle:{width:"78%"}},[i("mt-radio",{staticStyle:{display:"flex",border:"none"},attrs:{options:t.options},model:{value:t.value,callback:function(o){t.value=o},expression:"value"}})],1)]):t._e(),t._v(" "),1==t.value&&0==t.statu?i("div",{staticStyle:{display:"flex","padding-left":"20px","justify-content":"space-between","line-height":"30px","margin-bottom":"10px"}},[i("p",{staticStyle:{position:"relative"}},[t._v("\n        剩余房量\n        "),i("span",{staticStyle:{position:"absolute",top:"14px",left:"0","font-size":"12px"}},[t._v("(0为锁房)")])]),t._v("\n      "+t._s(t.allCount)+"\n      "),i("div",{staticStyle:{display:"flex","padding-right":"10px",width:"60%"}},[i("button",{directives:[{name:"show",rawName:"v-show",value:t.reNum_show,expression:"reNum_show"}],staticStyle:{width:"25%",border:"1px solid #cecece"},attrs:{id:"btn_reduce"},on:{click:t.reduce_num}},[t._v("-")]),t._v(" "),i("P",{staticStyle:{width:"35%",border:"1px solid #cecece"}},[t._v(t._s(t.currentNum))]),t._v(" "),i("button",{directives:[{name:"show",rawName:"v-show",value:t.addNum_show,expression:"addNum_show"}],staticStyle:{width:"25%",border:"1px solid #cecece"},attrs:{id:"btn_add"},on:{click:t.add_num}},[t._v("+")])],1)]):t._e(),t._v(" "),i("div",{staticClass:"btn"},[i("p",{staticStyle:{width:"50%",border:"1px solid #cecece","border-bottom-left-radius":"10px"},on:{click:t.btn_cancel}},[t._v("取消")]),t._v(" "),i("p",{staticStyle:{width:"50%",border:"1px solid #cecece","border-bottom-right-radius":"10px",color:"#fb9e58"},on:{click:t.btn_ok}},[t._v("确定")])])])],1)},staticRenderFns:[]};var r=e("k6Sl")(n,l,!1,function(t){e("P5df")},"data-v-4d654074",null);o.default=r.exports}});
//# sourceMappingURL=102.f1a80df5af54435af4a11758782009845.js.map